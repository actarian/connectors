!function(){"use strict";angular.module("app",["jsonFormatter"])}(),function(){"use strict";var b={HELPER:!1,JOINTS:!1,MODELS:!1,ANGLE:!1,NORMAL:!1},H=.025,M=0;var x=new THREE.Quaternion;x.setFromAxisAngle(new THREE.Vector3(0,1,0),Math.PI);var i=function(){function e(){var e=this;e.size=new THREE.Vector3,e.box=new THREE.Box3,e.group=new THREE.Group,e.outer=new THREE.Group,e.inner=new THREE.Group}return e.prototype={enter:function(e){var t=this;t.outer.position.x=t.size.x,TweenLite.to(t.outer.position,.6,{x:0,ease:Power2.easeOut,overwrite:"all",onComplete:function(){"function"==typeof e&&e()}})},load:function(e,t){for(var n=this,r=n.box,o=n.size,a=n.group,i=n.outer,s=n.inner,l=Number.POSITIVE_INFINITY,c=Number.NEGATIVE_INFINITY,p=0;p<e.vertices.length;p++)e.vertices[p].x*=H,e.vertices[p].y*=H,e.vertices[p].z*=H,l=Math.min(l,e.vertices[p].x),c=Math.max(c,e.vertices[p].x);var u=(c+l)/2;s.position.x=u,console.log(l,c,u);var d=new THREE.Mesh(e,t);r.setFromObject(d),r.getSize(o);var h=n.getJoints(e,t,o);n.quaternionL=d.quaternion.clone();var E=(new THREE.Quaternion).setFromUnitVectors(h.left.normal.clone().multiplyScalar(-1),h.right.normal);if(n.quaternionR=(new THREE.Quaternion).multiplyQuaternions(n.quaternionL,x).multiply(E.inverse()),n.positionL=new THREE.Vector3,n.positionR=h.left.origin.clone().sub(h.right.origin.clone().applyQuaternion(n.quaternionR)),d.geometry.mergeVertices(),THREE.GeometryUtils.computeVertexNormals(d.geometry,40),d.geometry.verticesNeedUpdate=!0,d.geometry.uvsNeedUpdate=!0,d.geometry=Curvature.setEdges(d.geometry),b.MODELS){t[1].color=new THREE.Color(0),e=new THREE.BoxGeometry(o.x,o.y,o.z);var m=new THREE.MeshStandardMaterial({color:new THREE.Color(.2*++M,0,0),wireframe:!1,transparent:!1,opacity:1});d=new THREE.Mesh(e,m)}for(var g in h){var f=h[g],v=f.normal.x,w=f.normal.y,T=-f.normal.z,R=new THREE.Euler(0,Math.atan2(T,v),Math.atan2(w,Math.sqrt(v*v+T*T)));if(f.rotation.copy(R),d.add(f),b.JOINTS){var y=new THREE.Mesh(new THREE.BoxGeometry(.1,.1,.1),new THREE.MeshBasicMaterial({color:f.color}));f.add(y)}}if(b.NORMAL){var y=new THREE.VertexNormalsHelper(d,.3,65280,1);s.add(y)}s.position.set(o.x/2-u,0,0),s.add(d),i.add(s),a.add(i),n.joints=h,n.model=d},flip:function(e){var t=this;t.inner;t.flipped=!t.flipped;var n={pow:t.flipped?0:1};TweenLite.to(n,.3,{pow:t.flipped?1:0,ease:Power2.easeOut,overwrite:"all",onUpdate:function(){THREE.Quaternion.slerp(t.quaternionL,t.quaternionR,t.model.quaternion,n.pow),t.model.position.lerpVectors(t.positionL,t.positionR,n.pow)},onComplete:function(){"function"==typeof e&&e()}})},getJoints:function(e,t,n){var r,o,a={},i={},s=["left","right","top","bottom"],l=[16711680,65280,255,16776960];t.filter(function(e,t){var n=s.indexOf(e.name);if(-1!==n){var r=new THREE.Group;r.name=s[n],r.color=l[n],r.vertices=[],a[e.name]=r,i[t]=r}});for(var c=0;c<e.faces.length;c++)o=e.faces[c],(r=i[String(o.materialIndex)])&&(r.normal=r.normal||o.normal,r.vertices.push(e.vertices[o.a]),r.vertices.push(e.vertices[o.b]),r.vertices.push(e.vertices[o.c]));for(var p in a)(r=a[p]).position.copy((u=r.vertices,void 0,d=u.reduce(function(e,t){return{x:e.x+t.x,y:e.y+t.y,z:e.z+t.z}}),(new THREE.Vector3).add(d).divideScalar(u.length))),r.origin=r.position.clone(),r.vertices=null;var u,d;a.left||(a.left=new THREE.Group,a.left.position.set(-n.x/2,0,0),a.left.origin=a.left.position.clone(),a.left.normal=new THREE.Vector3(-1,0,0),a.left.c=l[0]);a.right||(a.right=new THREE.Group,a.right.position.set(n.x/2,0,0),a.right.origin=a.right.position.clone(),a.right.normal=new THREE.Vector3(1,0,0),a.right.c=l[1]);b.ANGLE&&(a.right.normal.y+=.2);return a},setFlip:function(){var e=this,t=e.model;t.quaternion.copy(e.flipped?e.quaternionR:e.quaternionL),t.position.copy(e.flipped?e.positionR:e.positionL),e.group.updateMatrixWorld()}},e}(),e=function(){function e(e){var t=this;t.flags={rotate:!1},t.scene=e,t.flipping=0,t.entering=0,t.items=[],t.hittables=[],t.center=new THREE.Vector3,t.size=new THREE.Vector3,t.group=new THREE.Group,t.box=new THREE.Box3,b.HELPER&&(t.boxhelper=new THREE.Box3Helper(t.box,16711935),t.originhelper=new THREE.Mesh(new THREE.BoxGeometry(.1,.1,.1),new THREE.MeshBasicMaterial({color:11141375})),t.centerhelper=new THREE.Mesh(new THREE.BoxGeometry(.1,.1,.1),new THREE.MeshBasicMaterial({color:16711935})),t.group.add(t.originhelper),e.add(t.boxhelper),e.add(t.centerhelper)),e.add(t.group)}return e.prototype={add:function(e,t){var n=this,r=(n.box,n.size,n.items),o=(n.hittables,n.group);n.unselect();var a=new i;return a.load(e,t),r.push(a),n.hittables=r.map(function(e){return e.model}),o.add(a.group),a.setFlip(),n.adjust(),a},adjust:function(){this.combine(),this.fit()},busy:function(){return this.entering||this.flipping},combine:function(){var n,e=this.items,r=(this.group,new THREE.Quaternion),o=(new THREE.Vector3,new THREE.Vector3);e.length&&e.filter(function(e,t){e.flipped?(e.joints.right,n=e.joints.left):(e.joints.left,n=e.joints.right);0<t&&(e.group.setRotationFromQuaternion(r),e.group.position.copy(o));n.getWorldQuaternion(r),n.getWorldPosition(o)})},fit:function(){var e=this,t=e.box,n=e.size,r=e.center,o=e.centerhelper,a=e.group;t.setFromObject(a),t.getCenter(r),t.getSize(n),b.HELPER&&o.position.copy(r);return n},flip:function(e){this.selection&&this.flipItem(this.selection.item,e)},flipItem:function(e,t){var n=this;n.flipping++,e.flip(function(){n.flipping--,n.adjust(),"function"==typeof t&&setTimeout(function(){t()},100)})},hitAndFlip:function(e,t){var n=this.items,r=this.hittables,o=e.intersectObjects(r);if(o.length){var a=r.indexOf(o[0].object),i=n[a];this.flipItem(i,t)}},prev:function(){var e=this.items,t=null;if(e.length){var n=this.selection?this.selection.index:0;n=n-1<0?e.length-1:n-1;var r=e[n],o=r.outer.rotation.clone();t={index:n,item:r,rotation:o},this.selection=t}return t},pop:function(){var e=this,t=e.items,n=(e.hittables,e.group);if(t.length){var r=t.pop();return r.group.parent&&n.remove(r.group),e.hittables=t.map(function(e){return e.model}),e.adjust(),r}},next:function(){var e=this.items,t=null;if(e.length){var n=this.selection?this.selection.index:-1;n=n+1>=e.length?0:n+1;var r=e[n],o=r.outer.rotation.clone();t={index:n,item:r,rotation:o},this.selection=t}return t},remove:function(){var e=this,t=e.items,n=(e.hittables,e.group);{if(e.selection){var r=e.selection,o=r.item;return t.splice(r.index,1),o.group.parent&&n.remove(o.group),e.hittables=t.map(function(e){return e.model}),e.unselect(),e.adjust(),t.length>r.index&&(e.entering++,t[r.index].enter(function(){e.entering--})),o}return e.pop()}},rotate:function(e){this.selection.item.outer.rotation.x=this.selection.rotation.x+e,this.selection.item.group.updateMatrixWorld(),this.adjust()},select:function(e){var t=this.items,n=this.hittables;this.unselect();var r=e.intersectObjects(n),o=null;if(r.length){var a=n.indexOf(r[0].object),i=t[a],s=i.outer.rotation.clone();o={index:a,item:i,rotation:s},this.selection=o}return o},selectedItem:function(e){this.selection&&"function"==typeof e&&e(this.selection.item)},selectedModel:function(e){this.selection&&"function"==typeof e&&e(this.selection.item.model)},unselect:function(){this.selection&&(this.selection=null)},update:function(){var e=this,t=e.flags;if(!e.busy())if(t.rotate){if(e.items.length){var n=e.items[0];n.outer.rotation.x+=.01,e.adjust()}}else e.fit()}},e}();window.Combiner=e,angular.module("app").factory("Combiner",[function(){return e}])}(),function(){"use strict";var e=function(){function e(){}return e.setGeometry=function(e){var t,n,r,o,a,i,s,l,c,p,u,d,h,E,m,g,f,v,w,T,R,y={};for(n=e.attributes.position.array,r=e.attributes.normal.array,t=0;t<e.attributes.position.count;t+=3)o=new THREE.Vector3(n[3*t],n[3*t+1],n[3*t+2]),a=new THREE.Vector3(n[3*(t+1)],n[3*(t+1)+1],n[3*(t+1)+2]),i=new THREE.Vector3(n[3*(t+2)],n[3*(t+2)+1],n[3*(t+2)+2]),s=new THREE.Vector3(r[3*t],r[3*t+1],r[3*t+2]).normalize(),l=new THREE.Vector3(r[3*(t+1)],r[3*(t+1)+1],r[3*(t+1)+2]).normalize(),c=new THREE.Vector3(r[3*(t+2)],r[3*(t+2)+1],r[3*(t+2)+2]).normalize(),p=o.toArray().toString(),u=a.toArray().toString(),d=i.toArray().toString(),h=(new THREE.Vector3).subVectors(a,o),E=(new THREE.Vector3).subVectors(a,i),m=(new THREE.Vector3).subVectors(i,o),(new THREE.Vector3).subVectors(l,s),(new THREE.Vector3).subVectors(l,c),(new THREE.Vector3).subVectors(c,s),g=l.dot(h.normalize()),f=l.dot(E.normalize()),v=c.dot(m.normalize()),w=-s.dot(h.normalize()),T=-c.dot(E.normalize()),R=-s.dot(m.normalize()),y[p]=y[p]||{},y[p][u]=w,y[p][d]=R,y[u]=y[u]||{},y[u][p]=g,y[u][d]=f,y[d]=y[d]||{},y[d][p]=v,y[d][u]=T;var b={},H=1e3,M=0;Object.keys(y).forEach(function(e){var t,n,r;b[e]=(t=y[e],r=n=0,Object.keys(t).forEach(function(e){n+=t[e],r++}),n/r)}),Object.keys(b).forEach(function(e){var t=Math.abs(b[e]);t<H&&(H=t),M<t&&(M=t)});var x=M-H;console.log("range",x),Object.keys(b).forEach(function(e){var t=Math.abs(b[e]);b[e]<0?b[e]=(H-t)/x:b[e]=(t-H)/x});var S,L,z,j=new Float32Array(e.attributes.position.count);for(t=0;t<e.attributes.position.count;t++)n=e.attributes.position.array,S=new THREE.Vector3(n[3*t],n[3*t+1],n[3*t+2]),L=S.toArray().toString(),z=b[L],z=THREE.Math.clamp(2*THREE.Math.smoothstep(z,0,1),0,1),j[t]=z;e.addAttribute("curvature",new THREE.BufferAttribute(j,1))},e.setEdges=function(e,t){t=t||50;var n,r=e.faces,o=e.vertices;e=(new THREE.BufferGeometry).fromGeometry(e);var a,c,i,s,l,p,u,d,h,E,m,g,f,v,w,T,R,y={},b=(e.attributes.position.array,e.attributes.normal.array,e.attributes.color.array),H=new Array(e.attributes.position.count).fill(0),M=new Array(o.length).fill(0),x=new Array(o.length).fill(0);function S(e,t,n,r,o,a,i,s,l){T=Math.min(e,t),R=Math.max(e,t),void 0===y[c=T+"-"+R]?y[c]={ia:e,ib:t,pa:n,pb:r,na:i,va:o,ca:l}:(y[c].pc=n,y[c].pd=r,y[c].nb=s,y[c].vb=a,y[c].cb=l)}for(var L=0;L<r.length;L++){n=r[L],s=n.a,l=n.b,p=n.c,f=n.normal.clone(),v=n.normal.clone(),w=n.normal.clone(),u=o[s],d=o[l],h=o[p];var z=new THREE.Vector3;z.add(u),z.add(d),z.add(h),z.divideScalar(3),g=3*L+2,S(s,l,E=3*L+0,m=3*L+1,u,d,f,v,z),S(l,p,m,g,d,h,v,w,z),S(p,s,g,E,h,u,w,f,z)}var j=Object.keys(y),A=0;for(c in y){if((a=y[c]).nb){f=a.na,v=a.nb,w=(new THREE.Vector3).subVectors(a.cb,a.ca).normalize();var V=Math.acos(THREE.Math.clamp(f.dot(v),-1,1));V*=THREE.Math.RAD2DEG;var N=f.dot(w);N<0&&(V+=180),180<V?A++:V=0,V/=360,M[a.ia]+=V,M[a.ib]+=V,x[a.ia]++,x[a.ib]++}}for(i=0;i<M.length;i++){var I=x[i];0<I&&(M[i]/=I)}for(c in y)(a=y[c]).nb&&(H[a.pa]=M[a.ia],H[a.pb]=M[a.ib],H[a.pd]=M[a.ia],H[a.pc]=M[a.ib]);for(i=0;i<H.length;i++)b[3*i+0]=H[i],b[3*i+1]=.1,b[3*i+2]=.1;return H=new Float32Array(H),e.addAttribute("curvature",new THREE.BufferAttribute(H,1)),console.log("points",M.length,"faces",r.length,"positions",e.attributes.position.count),console.log("edges",j.length,"matches",A,(A/j.length*100).toFixed(2)+"%","angle",t+"Â°"),e},e}();window.Curvature=e,angular.module("app").factory("Curvature",[function(){return e}])}(),function(){"use strict";var e=function(){function e(e,t,n,r,o){var a=new THREE.RenderPass(e,t),i=new THREE.OutlinePass(new THREE.Vector2(r,o),e,t);i.visibleEdgeColor.set(65280),i.hiddenEdgeColor.set(0),i.edgeStrength=5,i.edgeGlow=0,i.edgeThickness=1,i.pulsePeriod=2,i.rotate=!1,i.usePatternTexture=!1;var s=new THREE.ShaderPass(THREE.FXAAShader);s.uniforms.resolution.value.set(1/r,1/o),s.renderToScreen=!0;var l=new THREE.EffectComposer(n);l.addPass(a),l.addPass(i),l.addPass(s),this.renderPass=a,this.outlinePass=i,this.fxaaPass=s,this.composer=l}return e.prototype={update:function(){this.composer.render()},resize:function(e,t){this.composer.setSize(e,t),this.fxaaPass.uniforms.resolution.value.set(1/e,1/t)},select:function(e){this.outlinePass.selectedObjects=[e]},unselect:function(){this.outlinePass.selectedObjects=[]}},e}();window.Effects=e,angular.module("app").factory("Effects",[function(){return e}])}(),function(){"use strict";var o=!0,w=Math.PI/180;var e=function(){function e(e,t,n){var r=this;r.scene=e,r.camera=t,r.dummy=t.clone(),r.controls=n,r.projector=new THREE.Projector,r.position=new THREE.Vector3,r.target=new THREE.Vector3,r.center=new THREE.Vector3,r.size=new THREE.Vector3,r.box=new THREE.Box3,r.boxhelper=new THREE.Box3Helper(r.box,16711680),r.rotate=!1,r.target=new THREE.Vector3(0,0,0),r.distance=22,r.angle=0,r.endTarget=new THREE.Vector3(0,0,0),r.position=new THREE.Vector3(0,0,0),r.distanceMin=10,r.distanceMax=34,r.rotationAngle=1,r.dragAngle=0,r.zoom=1,r.pow=0,o&&r.scene.add(r.boxhelper)}return e.prototype={fit:function(e,t,n){t||(t=1.3);n||(n=new THREE.Vector3(0,1,0));var r=this,o=(r.projector,r.box),a=r.size,i=r.center,s=r.camera,l=r.controls,c=r.dummy,p=e.selection?e.selection.item.group:e.group;o.setFromObject(p),o.getCenter(i),c.position.copy(s.position),c.quaternion.copy(s.quaternion),c.up=n,c.lookAt(i),c.updateProjectionMatrix();r.toScreen(o.min),r.toScreen(o.max),r.toScreen(i);o.applyMatrix4(c.matrixWorldInverse),o.getSize(a);var u=a.x/a.y,d=s.aspect>u?a.y:a.x;s.aspect<u&&(d/=s.aspect);var h=(d*=t)/2/Math.sin(s.fov/2*w);c.position.normalize().multiplyScalar(h),r.distance=c.position.distanceTo(i),c.updateProjectionMatrix();var E=s.position.clone(),m=c.position,g=s.quaternion.clone(),f=c.quaternion,v={pow:0};TweenLite.to(v,.6,{pow:1,ease:Power2.easeOut,overwrite:"all",onUpdate:function(){s.position.lerpVectors(E,m,v.pow),THREE.Quaternion.slerp(g,f,s.quaternion,v.pow),s.updateProjectionMatrix()},onComplete:function(){l&&(l.target.copy(i),l.update())}})},toScreen:function(e){var t=this.camera,n=window.innerWidth/2,r=window.innerHeight/2,o=e.clone();return o.project(t),o.x=(o.x+1)*n,o.y=(1-o.y)*r,o},toWorld:function(e){var t=this.projector,n=this.camera,r=window.innerWidth/2,o=window.innerHeight/2,a=e.clone();return a.x=a.x/r-1,a.y=-a.y/o+1,t.unprojectVector(a,n),a},update:function(){var e=this,t=e.target,n=e.endTarget,r=e.position,o=e.distance,a=e.zoom,i=e.dragAngle,s=e.rotationAngle,l=(e.pow,e.camera);e.rotate&&(s=e.rotationAngle+=2e-4);t.x+=(n.x-t.x)/40,t.y+=(n.y-t.y)/40,t.z+=(n.z-t.z)/40,r.x=t.x+o*a*Math.cos(i+s),r.y=t.y+o*a,r.z=t.z+o*a*Math.sin(i+s),l.position.x+=(r.x-l.position.x)/13,l.position.y+=(r.y-l.position.y)/13,l.position.z+=(r.z-l.position.z)/13,l.lookAt(t)}},e}();window.Fitter=e,angular.module("app").factory("Fitter",[function(){return e}])}(),function(){"use strict";var e=function(){function e(){this.loader=new THREE.JSONLoader}e.prototype={load:function(n){var r=this;(function(e){var t={method:"GET",responseType:"text"};if(!e||!e.url||!e.onload)return;for(var n in e)t[n]=e[n];var r=new XMLHttpRequest;r.open(t.method,t.url,!0),r.responseType=t.responseType,r.onload=function(){200===this.status&&t.onload(this.response)},t.onerror&&(r.onerror=t.onerror);t.onprogress&&(r.onerror=t.onprogress);r.send()})({url:t%2==0?"img/Curved Body 1.js":"img/Angled Emitter 1.js",onload:function(e){e=(e=e.replace(new RegExp("transparency","g"),"opacity")).replace(new RegExp(".#QNAN0","g"),".0");var t=r.loader.parse(JSON.parse(e));n(t.geometry,t.materials)}}),t++}};var t=0;return e}();window.Forge=e,angular.module("app").factory("Forge",[function(){return e}])}(),function(){"use strict";var e=function(){var t={FINISHES:["standard","black","weathered"],randomFinish:function(){return{key:t.FINISHES[Math.floor(Math.random()*t.FINISHES.length)],color:null}},randomSecondaryFinish:function(){return{key:t.FINISHES[Math.floor(Math.random()*t.FINISHES.length)],color:null}}},n="img/textures/",r=1;function c(e){r=e.capabilities.getMaxAnisotropy(),this.replaceShader();var t=new THREE.LoadingManager;this.renderer=e,this.manager=t,this.textures=this.getTextures(),this.materials=this.getMaterials()}function a(e,t){var n=new THREE.Color(e.color.getHex()),r=new THREE.Color(t);TweenLite.to(n,.4,{r:r.r,g:r.g,b:r.b,onUpdate:function(){e.color=n}})}function o(e,t){var n=new THREE.StandardNodeMaterial,r=new THREE.AttributeNode("curvature","float"),o=new THREE.TextureNode(t.brushed),a=new THREE.Math1Node(o,THREE.Math1Node.INVERT),i=new THREE.Math3Node(a,new THREE.ColorNode(0),new THREE.FloatNode(.8),THREE.Math3Node.MIX),s=(new THREE.ColorNode(4473924),new THREE.ColorNode(0),new THREE.Math3Node(i,o,r,THREE.Math3Node.MIX));n.color=s;var l=new THREE.FloatNode(.8),c=new THREE.FloatNode(.4),p=new THREE.Math3Node(l,c,r,THREE.Math3Node.MIX);return n.roughness=p,n.metalness=new THREE.FloatNode(.99),n.name=e,n.build(),n}return c.prototype={getMaterials:function(){this.manager,this.loader;var e=this.textures;return{left:new THREE.MeshPhongMaterial({name:"left",color:new THREE.Color(16711680),visible:!1}),right:new THREE.MeshPhongMaterial({name:"right",color:new THREE.Color(65280),visible:!1}),top:new THREE.MeshPhongMaterial({name:"top",color:new THREE.Color(255),visible:!1}),bottom:new THREE.MeshPhongMaterial({name:"bottom",color:new THREE.Color(16776960),visible:!1}),floor:new THREE.MeshStandardMaterial({name:"floor",color:1052688,roughness:.5,metalness:.1,bumpMap:e.floor,bumpScale:.05,envMap:e.env}),wrap:new THREE.MeshPhongMaterial({name:"wrap",color:1052688,specular:4473924,shininess:7,reflectivity:.75,specularMap:e.leatherLight,bumpMap:e.leatherBump,bumpScale:.15}),bronze:new THREE.MeshStandardMaterial({name:"bronze",color:12615517,roughness:.5,roughnessMap:e.silver,metalness:.9,metalnessMap:e.weathered,envMap:e.env,envMapIntensity:.15}),gold:new THREE.MeshStandardMaterial({name:"gold",color:13151584,roughness:.5,roughnessMap:e.silver,metalness:.9,metalnessMap:e.weathered,envMap:e.env,envMapIntensity:.15}),green:new THREE.MeshPhongMaterial({name:"green",color:43520,specular:3355443,specularMap:e.silver,shininess:30,reflectivity:.1,envMap:e.env,bumpMap:e.silver,bumpScale:.003}),red:new THREE.MeshPhongMaterial({name:"red",color:14483456,specular:3355443,specularMap:e.silver,shininess:30,reflectivity:.1,envMap:e.env,bumpMap:e.silver,bumpScale:.003}),standard:{silver:new THREE.MeshStandardMaterial({name:"silver",color:8947848,roughness:.4,metalness:.99,metalnessMap:e.brushed,envMap:e.env,envMapIntensity:1,bumpMap:e.brushed,bumpScale:.01}),black:new THREE.MeshStandardMaterial({name:"black",color:1052688,roughness:.5,metalness:.99,metalnessMap:e.sand,envMap:e.env,envMapIntensity:1,bumpMap:e.sand,bumpScale:.015})},weathered:{silver:o("silver",e),black:o("black",e),_silver:new THREE.MeshStandardMaterial({name:"silver",color:5592405,map:e.brushed,roughness:.6,roughnessMap:e.weatheredInverted,metalness:.99,envMap:e.env,envMapIntensity:1}),_black:new THREE.MeshStandardMaterial({name:"black",color:4473924,map:e.brushed,roughness:.6,roughnessMap:e.weatheredInverted,metalness:.99,envMap:e.env,envMapIntensity:1})},black:{silver:new THREE.MeshStandardMaterial({name:"silver",color:1250067,roughness:.5,metalness:.99,metalnessMap:e.sand,envMap:e.env,envMapIntensity:1,bumpMap:e.sand,bumpScale:.015}),black:new THREE.MeshStandardMaterial({name:"black",color:1052688,roughness:.5,metalness:.99,metalnessMap:e.sand,envMap:e.env,envMapIntensity:1,bumpMap:e.sand,bumpScale:.015})},light:{off:new THREE.MeshPhongMaterial({name:"light",opacity:.98,transparent:!0,color:4473924,specular:8947848,shininess:20,reflectivity:.3}),on6:new THREE.MeshPhongMaterial({name:"light",opacity:.98,transparent:!0,color:4473924,emissive:4473924,specular:8947848,shininess:20,reflectivity:.3}),on12:new THREE.MeshPhongMaterial({name:"light",color:16777215,emissive:8947848,specular:16777215,shininess:100,reflectivity:.3})},glare:{off:new THREE.MeshLambertMaterial({name:"glare",opacity:0,transparent:!0,color:0}),on6:new THREE.MeshLambertMaterial({name:"glare",opacity:.6,transparent:!0,color:15529211,map:e.glare,blending:THREE.AdditiveBlending,specular:0,shininess:0,combine:THREE.MixOperation,reflectivity:0}),on12:new THREE.MeshLambertMaterial({name:"glare",opacity:.85,transparent:!0,color:15529211,map:e.glare,blending:THREE.AdditiveBlending,specular:0,shininess:0,combine:THREE.MixOperation,reflectivity:0})},emitterGlare:{off:new THREE.MeshLambertMaterial({name:"glare",opacity:0,transparent:!0,color:0}),on6:new THREE.MeshLambertMaterial({name:"glare",opacity:.6,transparent:!0,color:15529211,map:e.emitterGlare,blending:THREE.AdditiveBlending,specular:0,shininess:0,combine:THREE.MixOperation,reflectivity:0}),on12:new THREE.MeshLambertMaterial({name:"glare",opacity:.85,transparent:!0,color:15529211,map:e.emitterGlare,blending:THREE.AdditiveBlending,specular:0,shininess:100,combine:THREE.MixOperation,reflectivity:0})}}},getTextures:function(){var e=this,t=(this.manager,{});return t.env=e.getTextureCube("env/"),t.env.anisotropy=r,t.env.format=THREE.RGBFormat,t.floor=e.getTexture("floor.jpg"),t.floor.anisotropy=r,t.floor.wrapS=THREE.RepeatWrapping,t.floor.wrapT=THREE.RepeatWrapping,t.floor.repeat.set(40,40),t.silver=e.getTexture("brushed-light.jpg"),t.silver.anisotropy=r,t.silver.wrapT=THREE.RepeatWrapping,t.weathered=e.getTexture("weathered-512-tile.jpg"),t.weathered.anisotropy=r,t.weathered.wrapS=THREE.RepeatWrapping,t.weathered.wrapT=THREE.RepeatWrapping,t.weathered.repeat.set(2,8),t.weatheredInverted=e.getTexture("weathered-512-inverted.jpg"),t.weatheredInverted.anisotropy=r,t.weatheredInverted.wrapS=THREE.RepeatWrapping,t.weatheredInverted.wrapT=THREE.RepeatWrapping,t.weatheredInverted.repeat.set(2,8),t.sand=e.getTexture("sand.bump.jpg"),t.sand.anisotropy=r,t.sand.wrapS=THREE.RepeatWrapping,t.sand.wrapT=THREE.RepeatWrapping,t.sand.repeat.set(2,6),t.brushed=e.getTexture("brushed-512-tile.jpg"),t.brushed.anisotropy=r,t.brushed.wrapS=THREE.RepeatWrapping,t.brushed.wrapT=THREE.RepeatWrapping,t.brushed.repeat.set(2,2),t.bump=e.getTexture("brushed-dark.jpg"),t.bump.anisotropy=r,t.bump.wrapS=THREE.RepeatWrapping,t.bump.wrapT=THREE.RepeatWrapping,t.bump.repeat.set(5,5),t.glare=e.getTexture("glare.jpg"),t.glare.anisotropy=r,t.emitterGlare=e.getTexture("emitter-glare.jpg"),t.emitterGlare.anisotropy=r,t.leatherBump=e.getTexture("leather-bump.jpg"),t.leatherBump.anisotropy=r,t.leatherBump.wrapS=THREE.RepeatWrapping,t.leatherBump.wrapT=THREE.RepeatWrapping,t.leatherLight=e.getTexture("leather-light.jpg"),t.leatherLight.anisotropy=r,t.leatherLight.wrapS=THREE.RepeatWrapping,t.leatherLight.wrapT=THREE.RepeatWrapping,t.reptileBump=e.getTexture("reptile-bump.jpg"),t.reptileBump.anisotropy=r,t.reptileBump.wrapS=THREE.RepeatWrapping,t.reptileBump.wrapT=THREE.RepeatWrapping,t.reptileLight=e.getTexture("reptile-light.jpg"),t.reptileLight.anisotropy=r,t.reptileLight.wrapS=THREE.RepeatWrapping,t.reptileLight.wrapT=THREE.RepeatWrapping,t.stingrayBump=e.getTexture("stingray-bump.jpg"),t.stingrayBump.anisotropy=r,t.stingrayBump.wrapS=THREE.RepeatWrapping,t.stingrayBump.wrapT=THREE.RepeatWrapping,t.stingrayLight=e.getTexture("stingray-light.jpg"),t.stingrayLight.anisotropy=r,t.stingrayLight.wrapS=THREE.RepeatWrapping,t.stingrayLight.wrapT=THREE.RepeatWrapping,t},getTexture:function(e){var t=this.manager;this.textures;return new THREE.TextureLoader(t).load(n+e,function(e){},function(e,t){},function(e){})},getTextureCube:function(e){var t=this.manager;this.textures;return new THREE.CubeTextureLoader(t).setPath(n+e).load(["px.jpg","nx.jpg","py.jpg","ny.jpg","pz.jpg","nz.jpg"],function(e){},function(e,t){},function(e){})},getTextureCubeHdr:function(e,r){var o=this,a=this.renderer,i=(this.manager,this.textures),t=[n+e+"px.hdr",n+e+"nx.hdr",n+e+"py.hdr",n+e+"ny.hdr",n+e+"pz.hdr",n+e+"nz.hdr"];return(new THREE.HDRCubeTextureLoader).load(THREE.UnsignedByteType,t,function(e){a.gammaInput=!0,a.gammaOutput=!0,a.toneMapping=THREE.LinearToneMapping,a.toneMappingExposure=1.3;var t=new THREE.PMREMGenerator(e);t.update(a);var n=new THREE.PMREMCubeUVPacker(t.cubeLods);n.update(a),i[r]=n.CubeUVRenderTarget,e.dispose(),o.materials.weathered.silver.envMap=n.CubeUVRenderTarget,o.materials.weathered.silver.needsUpdate=!0,o.materials.weathered.black.envMap=n.CubeUVRenderTarget,o.materials.weathered.black.needsUpdate=!0})},replaceShader:function(){var e=THREE.ShaderChunk.meshphong_frag;THREE.ShaderChunk.meshphong_frag=e.replace("vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;","vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * specular + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;")},setFinish:function(e,n){n=n||t.randomFinish(),e=e.length?e:[e],console.log("library.setFinish",e,n);var r=this;return e.map(function(e,t){switch(e.name){case"silver":case"black":e=r.materials[n.key][e.name]}return e})},setNextFloor:function(){this.materials;var e=this.materials.floor,t={};switch(c.FLOOR=(c.FLOOR+1)%4){case 0:t.color=1052688,t.roughness=.5,t.metalness=.1,t.bumpScale=.05;break;case 1:t.color=11450305,t.roughness=.5,t.metalness=.1,t.bumpScale=.05;break;case 2:t.color=1052688,t.roughness=.5,t.metalness=.1,t.bumpScale=1e-4;break;case 3:t.color=11450305,t.roughness=.5,t.metalness=.1,t.bumpScale=1e-4}console.log("library.setNextFloor",c.FLOOR),function(e,t,n){var r={onComplete:function(){"function"==typeof n&&n()}};for(var o in t)"color"===o?a(e,t[o]):r[o]=t[o];TweenLite.to(e,.4,r)}(e,t,function(){console.log("materialTween.completed")})},updateMaterials:function(e,n,r){n=n||t.randomFinish();var o,a,i,s=this,l=this.textures;return e.map(function(e,t){switch(e.name=e.name.replace("chrome","silver"),e.name){case"silver":case"black":o=n.key,e=s.materials[o][e.name];break;case"wrap":o=r.key,a=r.color,e=s.materials.wrap.clone(),-1!=o.indexOf("Leather")?i="leather":-1!=o.indexOf("Reptile")?i="reptile":-1!=o.indexOf("Stingray")&&(i="stingray"),a=c.hexToRgb(a),e.color.r=a.r/255,e.color.g=a.g/255,e.color.b=a.b/255,e.specularMap=l[i+"Light"],e.bumpMap=l[i+"Bump"];break;case"bronze":case"gold":case"red":case"green":case"left":case"right":case"top":case"bottom":e=s.materials[e.name]}return e})}},c.hexToRgb=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null},c.FLOOR=0,c}();window.Library=e,angular.module("app").factory("Library",[function(){return e}])}(),function(){"use strict";var o=!1,h=Math.PI/180,E=11;var e=function(){function e(e,t,n){var r=this;r.scene=e,r.camera=t,r.dummy=t.clone(),r.controls=n,r.projector=new THREE.Projector,r.center=new THREE.Vector3,r.size=new THREE.Vector3,r.box=new THREE.Box3,r.boxhelper=new THREE.Box3Helper(r.box,16711680),r.rotate=!0,r.target=new THREE.Vector3(0,0,0),r.distance=2*E,r.rotationAngle=1,r.dragAngle=0,r.zoom=1,r.pow=0,r.values={target:new THREE.Vector3(0,0,0),distance:2*E,rotationAngle:0,dragAngle:0,zoom:0,pow:0},r.distanceMin=E,r.distanceMax=3*E,r.set(r.camera,r.target),o&&r.scene.add(r.boxhelper)}return e.prototype={fit:function(e,t,n){t||(t=1.3);n||(n=new THREE.Vector3(0,1,0));var r=this,o=(r.projector,r.box),a=r.size,i=r.center,s=r.camera,l=(r.controls,r.dummy),c=e.selection?e.selection.item.group:e.group;if(o.setFromObject(c),o.getCenter(i),o.getSize(a),0<e.items.length){r.set(l,i),l.fov=s.fov,l.aspect=s.aspect,a.applyMatrix4(l.matrixWorldInverse);var p=a.x/a.y,u=s.aspect>p?a.y:a.x;s.aspect<p&&(u/=s.aspect);var d=(u*=t)/2/Math.sin(s.fov/2*h);r.distance=d}else r.distance=E;r.distanceMin=.5*r.distance,r.distanceMax=1.5*r.distance,r.target.copy(i)},set:function(e,t){var n=this.values;e.position.x=t.x+n.distance*n.zoom*Math.cos(n.dragAngle+n.rotationAngle),e.position.y=t.y+n.distance*n.zoom,e.position.z=t.z+n.distance*n.zoom*Math.sin(n.dragAngle+n.rotationAngle),e.lookAt(t)},toScreen:function(e){var t=this.camera,n=window.innerWidth/2,r=window.innerHeight/2,o=e.clone();return o.project(t),o.x=(o.x+1)*n,o.y=(1-o.y)*r,o},toWorld:function(e){var t=this.projector,n=this.camera,r=window.innerWidth/2,o=window.innerHeight/2,a=e.clone();return a.x=a.x/r-1,a.y=-a.y/o+1,t.unprojectVector(a,n),a},tween:function(){var e=this,t=e.target,n=e.values;e.rotate&&(e.rotationAngle+=2e-4);var r=1/15;n.target.x+=(t.x-n.target.x)*r,n.target.y+=(t.y-n.target.y)*r,n.target.z+=(t.z-n.target.z)*r,n.distance+=(e.distance-n.distance)*r,n.rotationAngle+=(e.rotationAngle-n.rotationAngle)*r,n.dragAngle+=(e.dragAngle-n.dragAngle)*r,n.zoom+=(e.zoom-n.zoom)*r,n.pow+=(e.pow-n.pow)*r},update:function(){this.tween(),this.set(this.camera,this.values.target)}},e}();window.Orbiter=e,angular.module("app").factory("Orbiter",[function(){return e}])}(),function(){"use strict";angular.module("app").service("Polyfills",[function(){Array.prototype.fill||Object.defineProperty(Array.prototype,"fill",{value:function(e){if(null===this)throw new TypeError("this is null or not defined");for(var t=Object(this),n=t.length>>>0,r=arguments[1]>>0,o=r<0?Math.max(n+r,0):Math.min(r,n),a=arguments[2],i=void 0===a?n:a>>0,s=i<0?Math.max(n+i,0):Math.min(i,n);o<s;)t[o]=e,o++;return t}})}])}(),function(){"use strict";angular.module("app").service("Prototypes",[function(){Element.prototype.hasClass=function(e){return new RegExp("(?:^|\\s+)"+e+"(?:\\s+|$)").test(this.className)},Element.prototype.addClass=function(e){this.hasClass(e)||(this.className=this.className?this.className+" "+e:e)},Element.prototype.removeClass=function(e){this.hasClass(e)&&(this.className=this.className.split(e).join("").replace(/\s\s+/g," "))},Element.prototype.isDescendant=function(e){return function e(t,n){return t===n||!!t.parentNode&&e(t.parentNode,n)}(this,e)},Element.prototype.getBounds=function(){var e={x:0,y:0,width:this.offsetWidth,height:this.offsetHeight,center:{x:0,y:0}};return e.center.x=e.width/2,e.center.y=e.height/2,e},window.getTouch=function(e){var t=new THREE.Vector2;if(t.t=new THREE.Vector2,t.relativeTo=function(e){var t=e.getBoundingClientRect(),n=window.pageXOffset||document.documentElement.scrollLeft,r=window.pageYOffset||document.documentElement.scrollTop;this.x=(this.x-t.left-n)/e.offsetWidth*2-1,this.y=-(this.y-t.top-r)/e.offsetHeight*2+1},t.pinchSize=function(){return Math.sqrt((this.x-this.t.x)*(this.x-this.t.x)+(this.y-this.t.y)*(this.y-this.t.y))},t.count=1,"touchstart"==e.type||"touchmove"==e.type||"touchend"==e.type||"touchcancel"==e.type){var n=null,r=null,o=e.originalEvent?e.originalEvent.touches||e.originalEvent.changedTouches:e.touches||e.changedTouches;o&&o.length&&(n=o[0],1<o.length&&(r=o[1])),n&&(t.x=n.pageX,t.y=n.pageY),r&&(t.t.x=r.pageX,t.t.y=r.pageY,t.count=2)}else"click"!=e.type&&"mousedown"!=e.type&&"mouseup"!=e.type&&"mousemove"!=e.type&&"mouseover"!=e.type&&"mouseout"!=e.type&&"mouseenter"!=e.type&&"mouseleave"!=e.type||(t.x=e.pageX,t.y=e.pageY);return t}}])}(),function(){"use strict";function r(e,t,n){return e.filter(function(e){return e.angleTo(t)<n*THREE.Math.DEG2RAD}).reduce(function(e,t){return e.clone().add(t)}).normalize()}angular.module("app").service("ThreeUtils",[function(){THREE.GeometryUtils.computeVertexNormals=function(e,t){e.computeFaceNormals();var n=e.vertices.map(function(){return[]});e.faces.map(function(e){n[e.a].push(e.normal),n[e.b].push(e.normal),n[e.c].push(e.normal)}),e.faces.map(function(e){e.vertexNormals[0]=r(n[e.a],e.normal,t),e.vertexNormals[1]=r(n[e.b],e.normal,t),e.vertexNormals[2]=r(n[e.c],e.normal,t)}),0<e.faces.length&&(e.normalsNeedUpdate=!0)},THREE.FaceUtils={computeCentroid:function(e,t){var n=new THREE.Vector3;return n.add(t[e.a]),n.add(t[e.b]),n.add(t[e.c]),n.divideScalar(3),n}}}])}(),function(){"use strict";angular.module("app").directive("builder",["Polyfills","Prototypes","ThreeUtils",function(e,t,n){return{restrict:"A",link:function(e,t,n){console.log("app.builder");var a=t[0];if(Detector.webgl){var r,o,i,s=a.offsetWidth,l=a.offsetHeight,c={down:!1,moved:0},p=new THREE.Raycaster,u=new Forge,d=((r=new THREE.WebGLRenderer({alpha:!0,antialias:!0})).setClearColor(1052688),r.setPixelRatio(window.devicePixelRatio),r.setSize(s,l),a.appendChild(r.domElement),r),h=new Library(d),E=new THREE.PerspectiveCamera(45,s/l,1,5e4),m=new THREE.Scene,g=function(e){var t=new THREE.Group;t.name="pivot",t.rotation.y=Math.PI/180*90;var n=new THREE.AmbientLight(4473924);e.add(n);var r=new THREE.DirectionalLight(15654365,1,2e3);r.name="light1",r.position.set(-30,20,10),t.add(r);var o=new THREE.DirectionalLight(14540270,1,2e3);return o.name="light2",o.position.set(30,20,-10),t.add(o),e.add(t),t}(m),f=(o=m,(i=new THREE.Mesh(new THREE.PlaneBufferGeometry(500,500),h.materials.floor)).name="floor",i.rotation.x=-Math.PI/2,i.position.y=-3.5,i.visible=!0,o.add(i),i),v=new Combiner(m),w=new Orbiter(m,E),T=new Effects(m,E,d,s,l),R=document.querySelector(".btn-add"),y=document.querySelector(".btn-remove"),b=document.querySelector(".btn-flip"),H=document.querySelector(".btn-finish"),M=document.querySelector(".btn-floor");x(),a.addEventListener("mousedown",O),a.addEventListener("touchstart",F),a.addEventListener("mousewheel",C),document.addEventListener("keyup",k),window.addEventListener("resize",V,!1),R.addEventListener("click",S),y.addEventListener("click",L),b.addEventListener("click",z),H.addEventListener("click",j),M.addEventListener("click",A),setTimeout(S,1e3)}else Detector.addGetWebGLMessage();function x(){!function(){v.update();var e=v.center.y-v.size.y/2-3;f.position.y+=(e-f.position.y)/8,g.position.x+=(v.center.x-g.position.x)/8,g.position.y+=(v.center.y-g.position.y)/8,g.position.z+=(v.center.z-g.position.z)/8,w.update(),T.update()}(),!0===c.snapshot&&(c.snapshot=!1),c.requestId=window.requestAnimationFrame(x,d.domElement)}function S(){v.busy()||u.load(function(e,t){T&&T.unselect(),t=h.updateMaterials(t,null,null);var n=v.add(e,t);w.fit(v),v.entering++,n.enter(function(){v.entering--})})}function L(){v.busy()||(v.remove(),w.fit(v))}function z(){v.flip(function(){w.fit(v)})}function j(){v.selectedModel(function(e){e.material=h.setFinish(e.material,null)})}function A(){h.setNextFloor()}function V(){s=a.offsetWidth,l=a.offsetHeight,E.aspect=s/l,E.updateProjectionMatrix(),w.fit(v),d.setSize(s,l),T&&T.resize(s,l)}function N(e){var t=getTouch(e);t.relativeTo(a),t.mx=t.x,t.startDragAngle=w.dragAngle,t.startDistance=w.distance,p.setFromCamera(t,E);var n=v.select(p);n?(t.index=n.index,t.item=n.item,t.rotation=n.rotation,T&&T.select(t.item.model)):T&&T.unselect(),w.fit(v),c.down=t}function I(e){c.moved++;var t=1;"touchmove"===e.type&&(e.stopPropagation(),e.preventDefault(),t*=4);var n=c.down;if(n){var r=getTouch(e);r.relativeTo(a);var o=r.sub(n);2==r.count&&2==n.count?w.distance=n.startDistance+(n.pinchSize()-r.pinchSize())*t*10:v.selection&&v.selection.item===n.item?v.rotate(o.y*t*10):(w.dragAngle=n.startDragAngle+o.x*t*10,w.distance=n.startDistance+o.y*t*-10),w.distance=Math.min(w.distanceMax,Math.max(w.distanceMin,w.distance))}}function P(e){var t=c.down,n=c.moved;t&&n<5&&(t.item||v.selectedItem),c.down=null,c.moved=0,window.removeEventListener("touchmove mousemove",I),window.removeEventListener("touchend mouseup",P)}function C(e){e=window.event||e;var t=a.getBounds();if(Math.abs(e.pageX-t.center.x)<t.width/3){var n=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));w.distance+=n,w.distance=Math.min(w.distanceMax,Math.max(w.distanceMin,w.distance)),w.update(),e.preventDefault()}}function O(e){N(e),window.addEventListener("mousemove",I),window.addEventListener("mouseup",P)}function F(e){N(e),window.addEventListener("touchmove",I),window.addEventListener("touchend",P),e.stopPropagation(),e.preventDefault()}function k(e){var t;switch(e.keyCode){case 38:case 40:break;case 37:(t=v.prev())?T&&T.select(t.item.model):T&&T.unselect(),w.fit(v);break;case 39:(t=v.next())?T&&T.select(t.item.model):T&&T.unselect(),w.fit(v)}}}}}])}();
//# sourceMappingURL=app.min.js.map
