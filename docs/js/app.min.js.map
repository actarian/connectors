{"version":3,"sources":["docs/js/app.js"],"names":["Element","prototype","hasClass","name","RegExp","test","this","className","addClass","removeClass","split","join","replace","isDescendant","target","node","parentNode","getBounds","bounds","x","y","width","offsetWidth","height","offsetHeight","center","window","getTouch","e","t","THREE","Vector2","relativeTo","rect","getBoundingClientRect","scrollX","pageXOffset","document","documentElement","scrollLeft","scrollY","pageYOffset","scrollTop","left","top","pinchSize","Math","sqrt","count","type","touch","second","touches","originalEvent","changedTouches","length","pageX","pageY","DEBUG","HELPER","JOINTS","MODELS","ANGLE","FINISH","SCALE","PI","I","flipQuaternion","Quaternion","setFromAxisAngle","Vector3","CombinerItem","item","size","box","Box3","group","Group","outer","inner","enter","callback","position","TweenLite","to","ease","Power2","easeOut","overwrite","onComplete","load","geometry","materials","library","finish","v","vertices","z","names","colors","map","material","index","i","indexOf","MeshStandardMaterial","color","Color","visible","clone","model","Mesh","setFromObject","getSize","joints","getJoints","quaternionL","quaternion","quaternionD","setFromUnitVectors","normal","multiplyScalar","right","quaternionR","multiplyQuaternions","multiply","inverse","positionL","positionR","origin","sub","applyQuaternion","console","log","computeVertexNormals","verticesNeedUpdate","uvsNeedUpdate","BoxGeometry","wireframe","transparent","opacity","key","joint","euler","Euler","atan2","rotation","copy","add","helper","MeshBasicMaterial","set","flip","flipped","animation","pow","onUpdate","slerp","lerpVectors","face","ids","filter","faces","String","materialIndex","push","a","b","c","reduce","divideScalar","setFlip","updateMatrixWorld","Combiner","scene","combiner","flags","rotate","flipping","entering","items","hittables","boxhelper","Box3Helper","originhelper","centerhelper","unselect","adjust","combine","fit","busy","setRotationFromQuaternion","getWorldQuaternion","getWorldPosition","getCenter","selection","flipItem","setTimeout","hitAndFlip","raycaster","hitted","intersectObjects","object","pop","parent","remove","splice","select","update","first","Effects","camera","renderer","w","h","renderPass","RenderPass","outlinePass","OutlinePass","visibleEdgeColor","hiddenEdgeColor","edgeStrength","edgeGlow","edgeThickness","pulsePeriod","usePatternTexture","fxaaPass","ShaderPass","FXAAShader","uniforms","resolution","value","renderToScreen","composer","EffectComposer","addPass","render","resize","setSize","selectedObjects","RAD","Fitter","controls","fitter","dummy","projector","Projector","distance","angle","endTarget","distanceMin","distanceMax","rotationAngle","dragAngle","zoom","offset","up","lookAt","updateProjectionMatrix","toScreen","min","max","applyMatrix4","matrixWorldInverse","aspect","dim","sin","fov","normalize","distanceTo","vfrom","vto","qfrom","qto","innerWidth","innerHeight","screen","project","toWorld","world","unprojectVector","cos","Forge","loader","JSONLoader","service","options","o","method","responseType","url","onload","p","req","XMLHttpRequest","open","status","response","onerror","onprogress","send","http","data","parse","JSON","Library","BASE","ANISOTROPY","capabilities","getMaxAnisotropy","replaceShader","manager","LoadingManager","onProgress","loaded","total","textures","getTextures","getMaterials","floor","MeshPhongMaterial","bumpMap","bumpScale","specular","reflectivity","shininess","wrap","specularMap","leatherLight","leatherBump","MixOperation","bronze","silver","envMap","env","gold","green","red","standard","black","MultiplyOperation","weathered","roughness","metalness","metalnessMap","roughnessMap","light","off","on6","emissive","on12","glare","MeshLambertMaterial","blending","AdditiveBlending","emitterGlare","getTextureCube","anisotropy","format","RGBFormat","getTexture","wrapS","RepeatWrapping","wrapT","repeat","bump","reptileBump","reptileLight","stingrayBump","stingrayLight","TextureLoader","texture","CubeTextureLoader","setPath","getTextureCubeHdr","urls","HDRCubeTextureLoader","UnsignedByteType","cubemap","gammaInput","gammaOutput","toneMapping","LinearToneMapping","toneMappingExposure","generator","PMREMGenerator","packer","PMREMCubeUVPacker","cubeLods","CubeUVRenderTarget","dispose","needsUpdate","fragment","ShaderChunk","meshphong_frag","MIN","Orbiter","orbiter","values","tween","friction","Detector","webgl","forge","btnAdd","querySelector","btnRemove","btnFlip","container","WebGLRenderer","alpha","antialias","appendChild","domElement","PerspectiveCamera","Scene","lights","AmbientLight","light1","DirectionalLight","light2","addLights","PlaneBufferGeometry","down","effects","Raycaster","moved","addEventListener","onDown","onMove","onUp","stopPropagation","preventDefault","event","abs","delta","wheelDelta","detail","onAdd","animate","requestAnimationFrame","addGetWebGLMessage","mx","startDragAngle","startDistance","setFromCamera","enabled","move","diff","selectedItem","removeEventListener"],"mappings":"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","file":"app.min.js","sourcesContent":["/* global window, document, console  */\n\n(function () {\n    'use strict';\n\n    Element.prototype.hasClass = function (name) {\n        return new RegExp(\"(?:^|\\\\s+)\" + name + \"(?:\\\\s+|$)\").test(this.className);\n    };\n\n    Element.prototype.addClass = function (name) {\n        if (!this.hasClass(name)) {\n            this.className = this.className ? (this.className + ' ' + name) : name;\n        }\n    };\n\n    Element.prototype.removeClass = function (name) {\n        if (this.hasClass(name)) {\n            this.className = this.className.split(name).join('').replace(/\\s\\s+/g, ' '); // .replace(new RegExp('(?:^|\\\\s+)' + name + '(?:\\\\s+|$)', 'g'), '');\n        }\n    };\n\n    Element.prototype.isDescendant = function (target) {\n        function isDescendant(node, target) {\n            if (node === target) {\n                return true;\n            } else if (node.parentNode) {\n                return isDescendant(node.parentNode, target);\n            } else {\n                return false;\n            }\n        }\n        return isDescendant(this, target);\n    };\n\n    Element.prototype.getBounds = function () {\n        var bounds = {\n            x: 0,\n            y: 0,\n            width: this.offsetWidth,\n            height: this.offsetHeight,\n            center: {\n                x: 0,\n                y: 0\n            },\n        };\n        bounds.center.x = bounds.width / 2;\n        bounds.center.y = bounds.height / 2;\n        return bounds;\n    };\n\n    window.getTouch = function (e) {\n        var t = new THREE.Vector2();\n        t.t = new THREE.Vector2();\n        t.relativeTo = function (node) {\n            var rect = node.getBoundingClientRect();\n            var scrollX = window.pageXOffset || document.documentElement.scrollLeft;\n            var scrollY = window.pageYOffset || document.documentElement.scrollTop;\n            this.x = ((this.x - rect.left - scrollX) / node.offsetWidth) * 2 - 1;\n            this.y = -((this.y - rect.top - scrollY) / node.offsetHeight) * 2 + 1;\n        };\n        t.pinchSize = function () {\n            return Math.sqrt((this.x - this.t.x) * (this.x - this.t.x) + (this.y - this.t.y) * (this.y - this.t.y));\n        };\n        t.count = 1;\n        /*\n        var t = {\n            x: 0,\n            y: 0,\n            t: {\n                x: 0,\n                y: 0,\n            },\n            count: 1,\n            dist: function () {\n                return Math.sqrt((this.x - this.t.x) * (this.x - this.t.x) + (this.y - this.t.y) * (this.y - this.t.y));\n            }\n        };\n        */\n        if (e.type == 'touchstart' || e.type == 'touchmove' || e.type == 'touchend' || e.type == 'touchcancel') {\n            var touch = null,\n                second = null;\n            var touches = e.originalEvent ? e.originalEvent.touches || e.originalEvent.changedTouches : e.touches || e.changedTouches;\n            if (touches && touches.length) {\n                touch = touches[0];\n                if (touches.length > 1) {\n                    second = touches[1];\n                }\n            }\n            if (touch) {\n                t.x = touch.pageX;\n                t.y = touch.pageY;\n            }\n            if (second) {\n                t.t.x = second.pageX;\n                t.t.y = second.pageY;\n                t.count = 2;\n            }\n        } else if (e.type == 'click' || e.type == 'mousedown' || e.type == 'mouseup' || e.type == 'mousemove' || e.type == 'mouseover' || e.type == 'mouseout' || e.type == 'mouseenter' || e.type == 'mouseleave') {\n            t.x = e.pageX;\n            t.y = e.pageY;\n        }\n        return t;\n    };\n\n}());\n/* global window, document, console, TweenLite */\n\n(function () {\n    'use strict';\n\n    var DEBUG = {\n        HELPER: true,\n        JOINTS: true,\n        MODELS: true,\n        ANGLE: false,\n        FINISH: 'standard', // 'weathered',\n    };\n\n    var RAD = Math.PI / 180;\n    var SCALE = 0.025;\n    var I = 0;\n\n    function rad(degree) {\n        return degree * RAD;\n    }\n\n    var flipQuaternion = new THREE.Quaternion();\n    flipQuaternion.setFromAxisAngle(new THREE.Vector3(0, 1, 0), Math.PI);\n\n    var CombinerItem = function () {\n\n        function CombinerItem() {\n            var item = this;\n            item.size = new THREE.Vector3();\n            item.box = new THREE.Box3();\n            item.group = new THREE.Group();\n            item.outer = new THREE.Group();\n            item.inner = new THREE.Group();\n        }\n\n        CombinerItem.prototype = {\n            enter: enter,\n            load: load,\n            flip: flip,\n            getJoints: getJoints,\n            setFlip: setFlip,\n        };\n\n        function enter(callback) {\n            var item = this;\n            item.outer.position.x = item.size.x;\n            TweenLite.to(item.outer.position, 0.6, {\n                x: 0,\n                ease: Power2.easeOut,\n                overwrite: 'all',\n                // ease: Elastic.easeOut, \n                onComplete: function () {\n                    if (typeof callback === 'function') {\n                        callback();\n                    }\n                }\n            });\n        }\n\n        function getCentroid(vertices) {\n            var center = vertices.reduce(function (a, b) {\n                return {\n                    x: a.x + b.x,\n                    y: a.y + b.y,\n                    z: a.z + b.z\n                };\n            });\n            return new THREE.Vector3().add(center).divideScalar(vertices.length);\n        }\n\n        function getMaterials(materials, library, finish) {\n            var names = ['left', 'right', 'top', 'bottom'],\n                colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00],\n                index, finish = finish || DEBUG.FINISH;\n            return materials.map(function (material, index) {\n                var i = names.indexOf(material.name);\n                if (i !== -1) {\n                    return new THREE.MeshStandardMaterial({\n                        name: material.name,\n                        color: new THREE.Color(colors[i]),\n                        visible: false,\n                    });\n                } else {\n                    material.name = material.name.replace('chrome', 'silver');\n                    // console.log(material.name);\n                    return library.materials[finish][material.name].clone();\n                }\n            });\n        }\n\n        function getJoints(geometry, materials, size) {\n            var joints = {},\n                ids = {},\n                /*\n                diffs = [\n                    new THREE.Vector3(-size.x / 2, 0, 0), // left\n                    new THREE.Vector3(size.x / 2, 0, 0), // right\n                    new THREE.Vector3(0, -size.y / 2, 0), // top\n                    new THREE.Vector3(0, size.y / 2, 0), // bottom\n                ],\n                */\n                names = ['left', 'right', 'top', 'bottom'],\n                colors = [0xff0000, 0x00ff00, 0x0000ff, 0xffff00],\n                index, joint, face;\n            materials.filter(function (material, index) {\n                // console.log(material);\n                var i = names.indexOf(material.name);\n                if (i !== -1) {\n                    var joint = new THREE.Group();\n                    // joint.diff = diffs[i];\n                    joint.name = names[i];\n                    joint.color = colors[i];\n                    joint.vertices = [];\n                    joints[material.name] = joint;\n                    ids[index] = joint;\n                }\n            });\n            for (var i = 0; i < geometry.faces.length; i++) {\n                face = geometry.faces[i];\n                joint = ids[String(face.materialIndex)];\n                if (joint) {\n                    joint.normal = joint.normal || face.normal; // assume all faces point toward direction;\n                    joint.vertices.push(geometry.vertices[face.a]);\n                    joint.vertices.push(geometry.vertices[face.b]);\n                    joint.vertices.push(geometry.vertices[face.c]);\n                    // console.log(joint.name, joint.normal);\n                }\n            }\n            for (var key in joints) {\n                joint = joints[key];\n                joint.position.copy(getCentroid(joint.vertices));\n                joint.origin = joint.position.clone();\n                // joint.diff.sub(joint.position);\n                joint.vertices = null;\n            }\n            if (!joints.left) {\n                joints.left = new THREE.Group();\n                joints.left.position.set(-size.x / 2, 0, 0);\n                joints.left.origin = joint.position.clone();\n                joints.left.normal = new THREE.Vector3(-1, 0, 0);\n                joints.left.c = colors[0];\n            }\n            if (!joints.right) {\n                joints.right = new THREE.Group();\n                joints.right.position.set(size.x / 2, 0, 0);\n                joints.right.origin = joint.position.clone();\n                joints.right.normal = new THREE.Vector3(1, 0, 0);\n                joints.right.c = colors[1];\n            }\n            if (DEBUG.ANGLE) {\n                joints.right.normal.y += 0.2;\n            }\n            // console.log('item.getJoints', joints, size);\n            return joints;\n        }\n\n        function load(geometry, materials, library, finish) {\n            var item = this,\n                box = item.box,\n                size = item.size,\n                group = item.group,\n                outer = item.outer,\n                inner = item.inner;\n            for (var v = 0; v < geometry.vertices.length; v++) {\n                geometry.vertices[v].x *= SCALE;\n                geometry.vertices[v].y *= SCALE;\n                geometry.vertices[v].z *= SCALE;\n            }\n            materials = getMaterials(materials, library, finish);\n            var model = new THREE.Mesh(geometry, materials);\n            box.setFromObject(model);\n            box.getSize(size);\n            var joints = item.getJoints(geometry, materials, size);\n            item.quaternionL = model.quaternion.clone();\n            var quaternionD = new THREE.Quaternion().setFromUnitVectors(joints.left.normal.clone().multiplyScalar(-1), joints.right.normal);\n            item.quaternionR = new THREE.Quaternion().multiplyQuaternions(item.quaternionL, flipQuaternion).multiply(quaternionD.inverse());\n            item.positionL = new THREE.Vector3();\n            item.positionR = joints.left.origin.clone().sub(joints.right.origin.clone().applyQuaternion(item.quaternionR));\n            console.log(item.positionR);\n            model.geometry.computeVertexNormals();\n            model.geometry.verticesNeedUpdate = true;\n            model.geometry.uvsNeedUpdate = true;\n            // model.geometry.mergeVertices();\n            // model.geometry.computeFaceNormals();\n            // model.geometry.normalsNeedUpdate = true;\n            // model.geometry.uvsNeedUpdate = true;\n            // model.geometry.computeMorphNormals();\n            /*           \n            model.geometry.computeFaceNormals();\n            model.geometry.computeVertexNormals();\n            model.geometry.computeBoundingBox();\n            */\n            // console.log(model);\n            if (DEBUG.MODELS) {\n                // geometry = new THREE.CylinderGeometry(2, 2, 10, 10);            \n                materials[1].color = new THREE.Color(0x000000);\n                geometry = new THREE.BoxGeometry(size.x, size.y, size.z);\n                var material = new THREE.MeshStandardMaterial({\n                    color: new THREE.Color(0.2 * ++I, 0, 0),\n                    wireframe: false,\n                    transparent: false,\n                    opacity: 1.0,\n                });\n                model = new THREE.Mesh(geometry, material);\n            }\n            for (var key in joints) {\n                var joint = joints[key];\n                var x = joint.normal.x,\n                    y = joint.normal.y,\n                    z = -joint.normal.z;\n                var euler = new THREE.Euler(\n                    0,\n                    Math.atan2(z, x),\n                    Math.atan2(y, Math.sqrt(x * x + z * z))\n                );\n                joint.rotation.copy(euler);\n                model.add(joint);\n                // joint.oquaternion = new THREE.Quaternion().multiplyQuaternions(joint.quaternion, flipQuaternion);\n                if (DEBUG.JOINTS) {\n                    var helper = new THREE.Mesh(\n                        new THREE.BoxGeometry(0.1, 0.1, 0.1),\n                        new THREE.MeshBasicMaterial({\n                            color: joint.color,\n                        })\n                    );\n                    joint.add(helper);\n                    /*\n                    var s = size.x / 10;\n                    var arrow = new THREE.ArrowHelper(new THREE.Vector3(1, 0, 0), new THREE.Vector3(), s, joint.color, s / 2, s / 2);\n                    joint.add(arrow);\n                    */\n                }\n            }\n            inner.position.set(size.x / 2, 0, 0);\n            inner.add(model);\n            outer.add(inner);\n            group.add(outer);\n            item.joints = joints;\n            item.model = model;\n        }\n\n        function setFlip() {\n            var item = this,\n                model = item.model;\n            // THREE.Quaternion.slerp(item.quaternionL, item.quaternionR, item.model.quaternion, item.flipped ? 1 : 0);\n            model.quaternion.copy(item.flipped ? item.quaternionR : item.quaternionL);\n            model.position.copy(item.flipped ? item.positionR : item.positionL);\n            item.group.updateMatrixWorld();\n            /*\n            var position = new THREE.Vector3();\n            if (item.flipped) {\n                // model.quaternion.copy(item.joints.right.quaternion.conjugate());\n                // item.joints.right.localToWorld(position);\n                // item.pivot.worldToLocal(position);\n                // item.model.setRotationFromQuaternion(item.joints.right.quaternion.conjugate());\n                // item.model.position.set(0, 0, 0).sub(item.joints.right.origin);\n                // position.x -= item.size.x / 2;\n                // item.model.quaternion.setFromUnitVectors(item.joints.left.normal, item.joints.right.normal);\n            } else {\n                // model.quaternion.copy(item.joints.left.quaternion.conjugate());\n                // item.joints.left.localToWorld(position);\n                // item.pivot.worldToLocal(position);\n                // item.model.setRotationFromQuaternion(item.joints.left.quaternion.conjugate());\n                // item.model.position.set(0, 0, 0).sub(item.joints.left.origin);\n                // position.x += item.size.x / 2;\n                // item.model.setRotationFromQuaternion(new THREE.Quaternion());\n            }\n            item.model.updateMatrixWorld();\n            // console.log('setFlip', item.flipped, item.joints.left.quaternion);\n            */\n        }\n\n        function flip(callback) {\n            var item = this,\n                inner = item.inner;\n            // console.log('flip()');\n            item.flipped = !item.flipped;\n            var animation = {\n                pow: item.flipped ? 0 : 1\n            };\n            TweenLite.to(animation, 0.3, {\n                pow: item.flipped ? 1 : 0,\n                ease: Power2.easeOut,\n                overwrite: 'all',\n                // ease: Elastic.easeOut,\n                onUpdate: function () {\n                    THREE.Quaternion.slerp(item.quaternionL, item.quaternionR, item.model.quaternion, animation.pow);\n                    item.model.position.lerpVectors(item.positionL, item.positionR, animation.pow);\n                },\n                onComplete: function () {\n                    // console.log('flipped');\n                    // item.setFlip();\n                    if (typeof callback === 'function') {\n                        callback();\n                    }\n                },\n            });\n            /*\n            TweenLite.to(inner.rotation, 0.3, {\n                y: item.flipped ? Math.PI : 0,\n                ease: Power2.easeOut,\n                overwrite: 'all',\n                // ease: Elastic.easeOut,\n                // onUpdate: function() { },\n                onComplete: function () {\n                    // console.log('flipped');\n                    item.setFlip();\n                    if (typeof callback === 'function') {\n                        callback();\n                    }\n                },\n            });\n            */\n        }\n\n        return CombinerItem;\n\n    }();\n\n    var Combiner = function () {\n\n        function Combiner(scene, library) {\n            var combiner = this;\n            combiner.flags = {\n                rotate: false,\n            };\n            combiner.scene = scene;\n            combiner.library = library;\n            combiner.flipping = 0;\n            combiner.entering = 0;\n            combiner.items = [];\n            combiner.hittables = [];\n            combiner.center = new THREE.Vector3();\n            combiner.size = new THREE.Vector3();\n            combiner.group = new THREE.Group();\n            combiner.box = new THREE.Box3();\n            if (DEBUG.HELPER) {\n                combiner.boxhelper = new THREE.Box3Helper(combiner.box, 0xff00ff);\n                combiner.originhelper = new THREE.Mesh(\n                    new THREE.BoxGeometry(0.1, 0.1, 0.1),\n                    new THREE.MeshBasicMaterial({\n                        color: 0xaa00ff\n                    })\n                );\n                combiner.centerhelper = new THREE.Mesh(\n                    new THREE.BoxGeometry(0.1, 0.1, 0.1),\n                    new THREE.MeshBasicMaterial({\n                        color: 0xff00ff\n                    })\n                );\n                combiner.scene.add(combiner.boxhelper);\n                combiner.scene.add(combiner.originhelper);\n                combiner.scene.add(combiner.centerhelper);\n            }\n        }\n\n        Combiner.prototype = {\n            add: add,\n            adjust: adjust,\n            busy: busy,\n            combine: combine,\n            fit: fit,\n            flip: flip,\n            flipItem: flipItem,\n            hitAndFlip: hitAndFlip,\n            pop: pop,\n            remove: remove,\n            rotate: rotate,\n            select: select,\n            unselect: unselect,\n            update: update,\n        };\n\n        function add(geometry, materials, library, finish) {\n            var combiner = this,\n                library = combiner.library,\n                box = combiner.box,\n                size = combiner.size,\n                items = combiner.items,\n                hittables = combiner.hittables,\n                group = combiner.group;\n\n            combiner.unselect();\n            var item = new CombinerItem();\n            item.load(geometry, materials, library, finish);\n            items.push(item);\n            combiner.hittables = items.map(function (item) {\n                return item.model;\n            });\n            group.add(item.group);\n            item.setFlip();\n            combiner.adjust();\n            return item;\n        }\n\n        function adjust() {\n            var combiner = this;\n            combiner.combine();\n            combiner.fit();\n            // combiner.fitCamera();\n        }\n\n        function busy() {\n            var combiner = this;\n            return combiner.entering || combiner.flipping;\n        }\n\n        function combine() {\n            var combiner = this,\n                items = combiner.items,\n                group = combiner.group;\n            // var quaternionL = new THREE.Quaternion();\n            var quaternionR = new THREE.Quaternion();\n            var positionL = new THREE.Vector3();\n            var positionR = new THREE.Vector3();\n            var left, right;\n            // var groupPosition = new THREE.Vector3();\n            // var lquaternion;\n\n            function combineItem(item, i) {\n                if (item.flipped) {\n                    // lquaternion = item.joints.right.quaternion;\n                    left = item.joints.right;\n                    right = item.joints.left;\n                } else {\n                    // lquaternion = item.joints.left.oquaternion;\n                    left = item.joints.left;\n                    right = item.joints.right;\n                }\n                if (i > 0) {\n                    //\n                    item.group.setRotationFromQuaternion(quaternionR);\n                    item.group.position.copy(positionR);\n                    //\n                    // positionL = left.position.clone();\n                    // item.model.localToWorld(positionL);\n                    // \n                    if (false) {\n                        left.getWorldPosition(positionL);\n                        item.group.worldToLocal(positionL);\n                        item.group.position.sub(positionL);\n                    }\n                    //\n                    // console.log('left.position', positionL);\n                    // item.group.position.set(0, 0, 0);\n                    // left.getWorldQuaternion(quaternionL);\n                    /*\n                    positionR.sub(groupPosition);\n                    item.group.position.copy(positionR);\n                    // item.group.setRotationFromQuaternion(quaternionR.multiply(lquaternion));\n                    item.group.setRotationFromQuaternion(quaternionR);\n                    */\n                }\n                //} else {\n                //    item.group.rotation.z = rad(30);\n                //}\n                console.log(left.origin);\n                // right.updateMatrixWorld();\n                right.getWorldQuaternion(quaternionR);\n                right.getWorldPosition(positionR);\n            }\n            if (items.length) {\n                // group.getWorldPosition(groupPosition);\n                items.filter(combineItem);\n            }\n        }\n\n        function fit() {\n            var combiner = this,\n                box = combiner.box,\n                size = combiner.size,\n                center = combiner.center,\n                centerhelper = combiner.centerhelper,\n                group = combiner.group;\n            box.setFromObject(group);\n            box.getCenter(center);\n            box.getSize(size);\n            if (DEBUG.HELPER) {\n                centerhelper.position.copy(center);\n            }\n            /*\n            group.worldToLocal(center);\n            group.position.x = -center.x;\n            group.position.y = -center.y;\n            group.position.z = -center.z;\n            */\n            return size;\n        }\n\n        function flip(callback) {\n            var combiner = this,\n                items = combiner.items,\n                hittables = combiner.hittables;\n            if (combiner.selection) {\n                combiner.flipItem(combiner.selection.item, callback);\n            }\n        }\n\n        function flipItem(item, callback) {\n            var combiner = this;\n            combiner.flipping++;\n            item.flip(function () {\n                combiner.flipping--;\n                combiner.adjust();\n                // combiner.unselect(); ???\n                if (typeof (callback) === 'function') {\n                    setTimeout(function () {\n                        callback();\n                    }, 100);\n                }\n            });\n        }\n\n        function hitAndFlip(raycaster, callback) {\n            var combiner = this,\n                items = combiner.items,\n                hittables = combiner.hittables;\n            var hitted = raycaster.intersectObjects(hittables);\n            if (hitted.length) {\n                var index = hittables.indexOf(hitted[0].object);\n                var item = items[index];\n                combiner.flipItem(item, callback);\n            }\n        }\n\n        function pop() {\n            var combiner = this,\n                items = combiner.items,\n                hittables = combiner.hittables,\n                group = combiner.group;\n            if (items.length) {\n                var item = items.pop();\n                if (item.group.parent) {\n                    group.remove(item.group);\n                }\n                combiner.hittables = items.map(function (item) {\n                    return item.model;\n                });\n                combiner.adjust();\n                return item;\n            }\n        }\n\n        function remove() {\n            var combiner = this,\n                items = combiner.items,\n                hittables = combiner.hittables,\n                group = combiner.group;\n            if (combiner.selection) {\n                var selection = combiner.selection;\n                var item = selection.item;\n                items.splice(selection.index, 1);\n                if (item.group.parent) {\n                    group.remove(item.group);\n                }\n                combiner.hittables = items.map(function (item) {\n                    return item.model;\n                });\n                combiner.unselect();\n                combiner.adjust();\n                if (items.length > selection.index) {\n                    combiner.entering++;\n                    items[selection.index].enter(function () {\n                        combiner.entering--;\n                    });\n                }\n                return item;\n            } else {\n                return combiner.pop();\n            }\n        }\n\n        function rotate(y) {\n            var combiner = this;\n            combiner.selection.item.outer.rotation.x = combiner.selection.rotation.x + y;\n            combiner.selection.item.group.updateMatrixWorld();\n            combiner.adjust();\n        }\n\n        function select(raycaster) {\n            var combiner = this,\n                items = combiner.items,\n                hittables = combiner.hittables;\n\n            combiner.unselect();\n            var hitted = raycaster.intersectObjects(hittables);\n            var selection = null;\n            if (hitted.length) {\n                var index = hittables.indexOf(hitted[0].object);\n                var item = items[index];\n                var rotation = item.outer.rotation.clone();\n                /*\n                item.outline(true, combiner.library);\n                // item.model.material.emissive = new THREE.Color(0x888888);\n                */\n                // item.model.material.needsUpdate = true;\n                selection = {\n                    index: index,\n                    item: item,\n                    rotation: rotation,\n                };\n                combiner.selection = selection;\n            }\n            return selection;\n        }\n\n        function unselect() {\n            var combiner = this;\n            if (combiner.selection) {\n                /*\n                combiner.selection.item.outline(false, combiner.library);\n                // combiner.selection.item.model.material.emissive = new THREE.Color(0x000000);\n                */\n                // combiner.selection.item.model.material.needsUpdate = true;\n                combiner.selection = null;\n            }\n        }\n\n        function update() {\n            var combiner = this,\n                flags = combiner.flags;\n            if (!combiner.busy()) {\n                if (flags.rotate) {\n                    if (combiner.items.length) {\n                        var first = combiner.items[0];\n                        first.outer.rotation.x += 0.01;\n                        combiner.adjust();\n                    }\n                } else {\n                    // combiner.combine();\n                    combiner.fit();\n                }\n            }\n        }\n\n        return Combiner;\n\n    }();\n\n    window.Combiner = Combiner;\n\n}());\n/* global window, document, console, TweenLite */\n\n(function () {\n    'use strict';\n\n    var Effects = function () {\n\n        function Effects(scene, camera, renderer, w, h) {\n            var effects = this;\n            //\n            var renderPass = new THREE.RenderPass(scene, camera);\n            //\n            var outlinePass = new THREE.OutlinePass(new THREE.Vector2(w, h), scene, camera);\n            outlinePass.visibleEdgeColor.set(0x00ff00);\n            outlinePass.hiddenEdgeColor.set(0x000000);\n            outlinePass.edgeStrength = 5.0;\n            outlinePass.edgeGlow = 0.0;\n            outlinePass.edgeThickness = 1.0;\n            outlinePass.pulsePeriod = 2;\n            outlinePass.rotate = false;\n            outlinePass.usePatternTexture = false;\n            //\n            var fxaaPass = new THREE.ShaderPass(THREE.FXAAShader);\n            fxaaPass.uniforms.resolution.value.set(1 / w, 1 / h);\n            fxaaPass.renderToScreen = true;\n            //\n            var composer = new THREE.EffectComposer(renderer);\n            composer.addPass(renderPass);\n            composer.addPass(outlinePass);\n            composer.addPass(fxaaPass);\n            //\n            effects.renderPass = renderPass;\n            effects.outlinePass = outlinePass;\n            effects.fxaaPass = fxaaPass;\n            effects.composer = composer;\n        }\n\n        Effects.prototype = {\n            update: update,\n            resize: resize,\n            select: select,\n            unselect: unselect,\n        };\n\n        function update() {\n            var effects = this;\n            effects.composer.render();\n        }\n\n        function resize(w, h) {\n            var effects = this;\n            effects.composer.setSize(w, h);\n            effects.fxaaPass.uniforms.resolution.value.set(1 / w, 1 / h);\n        }\n\n        function select(object) {\n            var effects = this;\n            effects.outlinePass.selectedObjects = [object];\n        }\n\n        function unselect() {\n            var effects = this;\n            effects.outlinePass.selectedObjects = [];\n        }\n\n        return Effects;\n\n    }();\n\n    window.Effects = Effects;\n\n}());\n/* global window, document, console, TweenLite */\n\n(function () {\n    'use strict';\n\n    var DEBUG = true;\n    var RAD = Math.PI / 180;\n    var I = 0;\n\n    function rad(degree) {\n        return degree * RAD;\n    }\n\n    var Fitter = function () {\n\n        function Fitter(scene, camera, controls) {\n            var fitter = this;\n            fitter.scene = scene;\n            fitter.camera = camera;\n            fitter.dummy = camera.clone();\n            fitter.controls = controls;\n            fitter.projector = new THREE.Projector();\n            fitter.position = new THREE.Vector3();\n            fitter.target = new THREE.Vector3();\n            fitter.center = new THREE.Vector3();\n            fitter.size = new THREE.Vector3();\n            fitter.box = new THREE.Box3();\n            fitter.boxhelper = new THREE.Box3Helper(fitter.box, 0xff0000);\n\n            fitter.rotate = false;\n\n            fitter.target = new THREE.Vector3(0, 0, 0);\n            fitter.distance = 22;\n            fitter.angle = 0;\n\n            fitter.endTarget = new THREE.Vector3(0, 0, 0);\n            fitter.position = new THREE.Vector3(0, 0, 0);\n            fitter.distanceMin = 10;\n            fitter.distanceMax = 34;\n            fitter.rotationAngle = 1;\n            fitter.dragAngle = 0;\n            fitter.zoom = 1; // eliminabili ??\n            fitter.pow = 0; // eliminabili ??\n            /*\n            if (combiner.selected.item.type === APP.Parts.typeEnum.BladePlug) {\n                fitter.pow = 1;\n            } else {\n                fitter.pow = 0;\n            }\n            */\n            if (DEBUG) {\n                fitter.scene.add(fitter.boxhelper);\n            }\n        }\n\n        Fitter.prototype = {\n            fit: fit,\n            toScreen: toScreen,\n            toWorld: toWorld,\n            update: update,\n        };\n\n        function fit(combiner, offset, up) {\n            if (!offset) {\n                offset = 1.3;\n            }\n            if (!up) {\n                up = new THREE.Vector3(0, 1, 0);\n            }\n            var fitter = this,\n                projector = fitter.projector,\n                box = fitter.box,\n                size = fitter.size,\n                center = fitter.center,\n                camera = fitter.camera,\n                controls = fitter.controls,\n                dummy = fitter.dummy;\n            var object = combiner.selection ? combiner.selection.item.group : combiner.group;\n            box.setFromObject(object);\n            box.getCenter(center);\n            dummy.position.copy(camera.position);\n            dummy.quaternion.copy(camera.quaternion);\n            dummy.up = up;\n            dummy.lookAt(center);\n            dummy.updateProjectionMatrix();\n            var min = fitter.toScreen(box.min);\n            var max = fitter.toScreen(box.max);\n            var sc = fitter.toScreen(center);\n            box.applyMatrix4(dummy.matrixWorldInverse);\n            box.getSize(size);\n            var aspect = size.x / size.y;\n            var dim = (camera.aspect > aspect) ? size.y : size.x;\n            if (camera.aspect < aspect) {\n                dim /= camera.aspect;\n            }\n            dim *= offset;\n            var z = dim / 2 / Math.sin(camera.fov / 2 * RAD);\n            dummy.position.normalize().multiplyScalar(z);\n            fitter.distance = dummy.position.distanceTo(center);\n            // camera.far = distance + dim;\n            dummy.updateProjectionMatrix();\n            var vfrom = camera.position.clone();\n            var vto = dummy.position;\n            var qfrom = camera.quaternion.clone();\n            var qto = dummy.quaternion;\n            var animation = {\n                pow: 0,\n            };\n            TweenLite.to(animation, 0.6, {\n                pow: 1,\n                ease: Power2.easeOut,\n                overwrite: 'all',\n                // ease: Elastic.easeOut,\n                onUpdate: function () {\n                    camera.position.lerpVectors(vfrom, vto, animation.pow);\n                    THREE.Quaternion.slerp(qfrom, qto, camera.quaternion, animation.pow);\n                    camera.updateProjectionMatrix();\n                },\n                onComplete: function () {\n                    if (controls) {\n                        // controls.maxDistance = distance + dim;\n                        controls.target.copy(center);\n                        controls.update();\n                    }\n                }\n            });\n        }\n\n        function toWorld(v) {\n            var fitter = this,\n                projector = fitter.projector,\n                camera = fitter.camera,\n                w = window.innerWidth / 2,\n                h = window.innerHeight / 2;\n            var world = v.clone();\n            world.x = world.x / w - 1;\n            world.y = -world.y / h + 1;\n            projector.unprojectVector(world, camera);\n            return world;\n        }\n\n        function toScreen(v) {\n            var fitter = this,\n                camera = fitter.camera,\n                w = window.innerWidth / 2,\n                h = window.innerHeight / 2;\n            var screen = v.clone();\n            screen.project(camera);\n            screen.x = (screen.x + 1) * w;\n            screen.y = (-screen.y + 1) * h;\n            return screen;\n        }\n\n        function update() {\n            var fitter = this,\n                target = fitter.target,\n                endTarget = fitter.endTarget,\n                position = fitter.position,\n                distance = fitter.distance,\n                zoom = fitter.zoom,\n                dragAngle = fitter.dragAngle,\n                rotationAngle = fitter.rotationAngle,\n                pow = fitter.pow,\n                camera = fitter.camera;\n            if (fitter.rotate) {\n                rotationAngle = fitter.rotationAngle += 0.0002;\n            }\n\n            target.x += (endTarget.x - target.x) / 40;\n            target.y += (endTarget.y - target.y) / 40;\n            target.z += (endTarget.z - target.z) / 40;\n\n            position.x = target.x + distance * zoom * Math.cos(dragAngle + rotationAngle);\n            position.y = target.y + distance * zoom; // * (0.5 + 1.5 * (1 - pow));\n            position.z = target.z + distance * zoom * Math.sin(dragAngle + rotationAngle);\n\n            camera.position.x += (position.x - camera.position.x) / 13;\n            camera.position.y += (position.y - camera.position.y) / 13;\n            camera.position.z += (position.z - camera.position.z) / 13;\n            // camera.up = new THREE.Vector3(0, 0, -1);\n\n            camera.lookAt(target);\n        }\n\n        return Fitter;\n\n    }();\n\n    window.Fitter = Fitter;\n\n}());\n/* global window, document, console  */\n\n(function () {\n    'use strict';\n\n    var Forge = function () {\n\n        function Forge() {\n            var service = this;\n            service.loader = new THREE.JSONLoader();\n        }\n\n        Forge.prototype = {\n            load: load,\n        };\n\n        var i = 0;\n\n        function load(callback) {\n            var service = this;\n            http({\n                url: i % 2 === 0 ? 'img/Curved Body 2.js' : 'img/Angled Emitter 1.js',\n                onload: function (data) {\n                    data = data.replace(new RegExp('transparency', 'g'), 'opacity');\n                    data = data.replace(new RegExp('.#QNAN0', 'g'), '.0');\n                    var model = service.loader.parse(JSON.parse(data));\n                    callback(model.geometry, model.materials);\n                }\n            });\n            i++;\n        }\n\n        function http(options) {\n            var o = {\n                method: 'GET',\n                responseType: 'text',\n            };\n            if (!options || !options.url || !options.onload) {\n                return;\n            }\n            for (var p in options) {\n                o[p] = options[p];\n            }\n            var req = new XMLHttpRequest();\n            req.open(o.method, o.url, true);\n            req.responseType = o.responseType; // 'blob';\n            req.onload = function () {\n                if (this.status === 200) {\n                    // var blob = this.response;\n                    // var image = URL.createObjectURL(blob); // IE10+\n                    o.onload(this.response);\n                }\n            };\n            if (o.onerror) {\n                req.onerror = o.onerror;\n            }\n            if (o.onprogress) {\n                req.onerror = o.onprogress;\n            }\n            req.send();\n        }\n\n        return Forge;\n\n    }();\n\n    window.Forge = Forge;\n\n}());\n/* global window, document, console, TweenLite */\n\n(function () {\n    'use strict';\n\n    var Library = function () {\n\n        var BASE = 'img/textures/';\n        var ANISOTROPY = 1;\n\n        function Library(renderer) {\n            ANISOTROPY = renderer.capabilities.getMaxAnisotropy();\n            this.replaceShader();\n            var manager = new THREE.LoadingManager();\n            manager.onProgress = function (item, loaded, total) {\n                console.log('Library.manager.onProgress', item, loaded, total);\n            };\n            this.renderer = renderer;\n            this.manager = manager;\n            this.textures = this.getTextures();\n            this.materials = this.getMaterials();\n        }\n\n        // publics\n        Library.prototype = {\n            getMaterials: getMaterials,\n            getTextures: getTextures,\n            getTexture: getTexture,\n            getTextureCube: getTextureCube,\n            getTextureCubeHdr: getTextureCubeHdr,\n            replaceShader: replaceShader,\n        };\n\n        function getMaterials() {\n            var service = this,\n                manager = this.manager,\n                loader = this.loader,\n                textures = this.textures;\n            return {\n                floor: new THREE.MeshPhongMaterial({\n                    bumpMap: textures.floor,\n                    bumpScale: 0.05,\n                    color: 0x101010,\n                    specular: 0x101010,\n                    reflectivity: 0.15,\n                    shininess: 12,\n                    // metal: true,\n                }),\n                wrap: new THREE.MeshPhongMaterial({\n                    name: 'wrap',\n                    color: 0x101010,\n                    specular: 0x444444,\n                    shininess: 7,\n                    reflectivity: 0.75,\n                    specularMap: textures.leatherLight,\n                    bumpMap: textures.leatherBump,\n                    bumpScale: 0.15,\n                    combine: THREE.MixOperation,\n                    // metal: true,\n                }),\n                bronze: new THREE.MeshPhongMaterial({\n                    name: 'bronze',\n                    color: 0xc07f5d,\n                    specular: 0x555555,\n                    specularMap: textures.silver,\n                    shininess: 10,\n                    reflectivity: 0.20,\n                    envMap: textures.env,\n                    combine: THREE.MixOperation,\n                    bumpMap: textures.silver,\n                    bumpScale: 0.001,\n                    // metal: true,\n                }),\n                gold: new THREE.MeshPhongMaterial({\n                    name: 'gold',\n                    color: 0xc8ad60,\n                    specular: 0x555555,\n                    specularMap: textures.silver,\n                    shininess: 10,\n                    reflectivity: 0.20,\n                    envMap: textures.env,\n                    combine: THREE.MixOperation,\n                    bumpMap: textures.silver,\n                    bumpScale: 0.001,\n                    // metal: true,\n                }),\n                green: new THREE.MeshPhongMaterial({\n                    name: 'green',\n                    color: 0x00aa00,\n                    specular: 0x333333,\n                    specularMap: textures.silver,\n                    shininess: 30,\n                    reflectivity: 0.10,\n                    envMap: textures.env,\n                    combine: THREE.MixOperation,\n                    bumpMap: textures.silver,\n                    bumpScale: 0.003,\n                    // metal: true,\n                }),\n                red: new THREE.MeshPhongMaterial({\n                    name: 'red',\n                    color: 0xdd0000,\n                    specular: 0x333333,\n                    specularMap: textures.silver,\n                    shininess: 30,\n                    reflectivity: 0.10,\n                    envMap: textures.env,\n                    combine: THREE.MixOperation,\n                    bumpMap: textures.silver,\n                    bumpScale: 0.003,\n                    // metal: true,\n                }),\n                standard: {\n                    silver: new THREE.MeshPhongMaterial({\n                        name: 'chrome',\n                        color: 0x888888,\n                        specular: 0x555555,\n                        specularMap: textures.silver,\n                        shininess: 30,\n                        reflectivity: 0.15,\n                        envMap: textures.env,\n                        combine: THREE.MixOperation,\n                        bumpMap: textures.silver,\n                        bumpScale: 0.003,\n                        // metal: true,\n                    }),\n                    black: new THREE.MeshPhongMaterial({ // MeshLambertMaterial\n                        name: 'black',\n                        color: 0x0d0d0d, // 0x0d0d0d\n                        reflectivity: 0.3,\n                        envMap: textures.env,\n                        combine: THREE.MultiplyOperation\n                    }),\n                },\n                weathered: {\n                    silver: new THREE.MeshPhongMaterial({\n                        name: 'chrome',\n                        color: 0x444444,\n                        specular: 0x555555,\n                        specularMap: textures.weathered,\n                        shininess: 90,\n                        reflectivity: 0.15,\n                        envMap: textures.env,\n                        combine: THREE.MixOperation,\n                        bumpMap: textures.silver,\n                        bumpScale: 0.003,\n                        // metal: true,\n                        map: textures.weathered,\n                        roughness: 0.2,\n                        // roughnessMap: textures.silver,\n                        metalness: 0.5,\n                        metalnessMap: textures.weathered,\n                    }),\n                    black: new THREE.MeshPhongMaterial({\n                        name: 'chrome',\n                        color: 0x333333,\n                        specular: 0x444444,\n                        specularMap: textures.weathered,\n                        shininess: 90,\n                        reflectivity: 0.05,\n                        envMap: textures.env,\n                        combine: THREE.MixOperation,\n                        bumpMap: textures.silver,\n                        bumpScale: 0.003,\n                        // metal: true,\n                        map: textures.weathered,\n                        roughness: 1.4,\n                        roughnessMap: textures.weathered,\n                        metalness: 0.5,\n                        metalnessMap: textures.silver,\n                    }),\n                    /*\n                    black: new THREE.MeshLambertMaterial({\n                        name: 'black',\n                        color: 0x070707, // 0x070707\n                        specular: 0x0a0a0a,\n                        reflectivity: 0.05,\n                        envMap: textures.env,\n                        combine: THREE.MultiplyOperation\n                    }),\n                    */\n                },\n                /*\n                silver: {\n                    silver: new THREE.MeshPhongMaterial({\n                        name: 'chrome',\n                        color: 0x888888,\n                        specular: 0x555555,\n                        specularMap: textures.silver,\n                        shininess: 30,\n                        reflectivity: 0.15,\n                        envMap: textures.env,\n                        combine: THREE.MixOperation,\n                        bumpMap: textures.silver,\n                        bumpScale: 0.003,\n                        // metal: true,\n                    }),\n                    black: new THREE.MeshPhongMaterial({\n                        name: 'black',\n                        color: 0x777777,\n                        specular: 0x444444,\n                        specularMap: textures.silver,\n                        shininess: 30,\n                        reflectivity: 0.15,\n                        envMap: textures.env,\n                        combine: THREE.MixOperation,\n                        bumpMap: textures.silver,\n                        bumpScale: 0.003,\n                        // metal: true,\n                    }),\n                },\n                */\n                black: {\n                    silver: new THREE.MeshPhongMaterial({\n                        name: 'chrome',\n                        color: 0x070707, // 0x070707\n                        specular: 0x0a0a0a,\n                        reflectivity: 0.05,\n                        envMap: textures.env,\n                        combine: THREE.MultiplyOperation\n                    }),\n                    black: new THREE.MeshPhongMaterial({ // MeshLambertMaterial\n                        name: 'black',\n                        color: 0x060606, // 0x060606\n                        specular: 0x0a0a0a,\n                        reflectivity: 0.05,\n                        envMap: textures.env,\n                        combine: THREE.MultiplyOperation\n                    }),\n                },\n                light: {\n                    off: new THREE.MeshPhongMaterial({\n                        name: 'light',\n                        opacity: 0.98,\n                        transparent: true,\n                        color: 0x444444,\n                        specular: 0x888888,\n                        shininess: 20,\n                        reflectivity: 0.3\n                    }),\n                    on6: new THREE.MeshPhongMaterial({\n                        name: 'light',\n                        opacity: 0.98,\n                        transparent: true,\n                        color: 0x444444,\n                        emissive: 0x444444,\n                        specular: 0x888888,\n                        shininess: 20,\n                        reflectivity: 0.3\n                    }),\n                    on12: new THREE.MeshPhongMaterial({\n                        name: 'light',\n                        color: 0xffffff,\n                        emissive: 0x888888,\n                        specular: 0xffffff,\n                        shininess: 100,\n                        reflectivity: 0.3\n                    }),\n                },\n                glare: {\n                    off: new THREE.MeshLambertMaterial({\n                        name: 'glare',\n                        opacity: 0,\n                        transparent: true,\n                        color: 0x000000,\n                    }),\n                    on6: new THREE.MeshLambertMaterial({\n                        name: 'glare',\n                        opacity: 0.6,\n                        transparent: true,\n                        color: 0xecf4fb,\n                        map: textures.glare,\n                        blending: THREE.AdditiveBlending,\n                        specular: 0x000000,\n                        shininess: 0,\n                        combine: THREE.MixOperation,\n                        reflectivity: 0\n                    }),\n                    on12: new THREE.MeshLambertMaterial({\n                        name: 'glare',\n                        opacity: 0.85,\n                        transparent: true,\n                        color: 0xecf4fb,\n                        map: textures.glare,\n                        blending: THREE.AdditiveBlending,\n                        specular: 0x000000,\n                        shininess: 0,\n                        combine: THREE.MixOperation,\n                        reflectivity: 0\n                    }),\n                },\n                emitterGlare: {\n                    off: new THREE.MeshLambertMaterial({\n                        name: 'glare',\n                        opacity: 0,\n                        transparent: true,\n                        color: 0x000000,\n                    }),\n                    on6: new THREE.MeshLambertMaterial({\n                        name: 'glare',\n                        opacity: 0.6,\n                        transparent: true,\n                        color: 0xecf4fb,\n                        map: textures.emitterGlare,\n                        blending: THREE.AdditiveBlending,\n                        specular: 0x000000,\n                        shininess: 0,\n                        combine: THREE.MixOperation,\n                        reflectivity: 0\n                    }),\n                    on12: new THREE.MeshLambertMaterial({\n                        name: 'glare',\n                        opacity: 0.85,\n                        transparent: true,\n                        color: 0xecf4fb,\n                        map: textures.emitterGlare,\n                        blending: THREE.AdditiveBlending,\n                        specular: 0x000000,\n                        shininess: 100,\n                        combine: THREE.MixOperation,\n                        reflectivity: 0\n                    }),\n                },\n            };\n        }\n\n        function getTexture(url) {\n            var service = this,\n                manager = this.manager,\n                textures = this.textures;\n            // scope.loader.add('texture-silver');\n            return new THREE.TextureLoader(manager).load(BASE + url,\n                function onLoad(texture) {\n                    // scope.loader.remove('texture-silver');            \n                },\n                function onProgress(loaded, total) {\n\n                },\n                function onError(e) {\n                    // scope.loader.remove('texture-silver');\n                });\n        }\n\n        function getTextureCube(url) {\n            var service = this,\n                manager = this.manager,\n                textures = this.textures;\n            // scope.loader.add('texture-silver');\n            return new THREE.CubeTextureLoader(manager).setPath(BASE + url).load([\n                    'px.jpg', 'nx.jpg', 'py.jpg', 'ny.jpg', 'pz.jpg', 'nz.jpg'\n                ],\n                function onLoad(texture) {\n                    // scope.loader.remove('texture-silver');\n                },\n                function onProgress(loaded, total) {\n\n                },\n                function onError(e) {\n                    // scope.loader.remove('texture-silver');\n                });\n        }\n\n        function getTextureCubeHdr(url, key) {\n            var service = this,\n                renderer = this.renderer,\n                manager = this.manager,\n                textures = this.textures;\n            var urls = [\n                BASE + url + 'px.hdr', BASE + url + 'nx.hdr',\n                BASE + url + 'py.hdr', BASE + url + 'ny.hdr',\n                BASE + url + 'pz.hdr', BASE + url + 'nz.hdr'\n            ];\n            return new THREE.HDRCubeTextureLoader().load(THREE.UnsignedByteType, urls, function (cubemap) {\n                renderer.gammaInput = true; // ???\n                renderer.gammaOutput = true;\n                renderer.toneMapping = THREE.LinearToneMapping;\n                renderer.toneMappingExposure = 1.3;\n                var generator = new THREE.PMREMGenerator(cubemap);\n                generator.update(renderer);\n                var packer = new THREE.PMREMCubeUVPacker(generator.cubeLods);\n                packer.update(renderer);\n                textures[key] = packer.CubeUVRenderTarget;\n                cubemap.dispose();\n                service.materials.weathered.silver.envMap = packer.CubeUVRenderTarget;\n                service.materials.weathered.silver.needsUpdate = true;\n                service.materials.weathered.black.envMap = packer.CubeUVRenderTarget;\n                service.materials.weathered.black.needsUpdate = true;\n                // generator.dispose();\n                // packer.dispose();\n                // scope.loader.remove('texture-silver');\n            });\n        }\n\n        function getTextures() {\n            var service = this,\n                manager = this.manager,\n                textures = {};\n            //\n            textures.env = service.getTextureCube('env/');\n            // textures.env = service.getTextureCubeHdr('env/pisa/', 'env');\n            textures.env.anisotropy = ANISOTROPY;\n            textures.env.format = THREE.RGBFormat;\n            // \n            textures.floor = service.getTexture('floor.jpg');\n            textures.floor.anisotropy = ANISOTROPY;\n            textures.floor.wrapS = THREE.RepeatWrapping;\n            textures.floor.wrapT = THREE.RepeatWrapping;\n            textures.floor.repeat.set(40, 40);\n            //\n            textures.silver = service.getTexture('brushed-light.jpg');\n            textures.silver.anisotropy = ANISOTROPY;\n            // textures.silver.wrapS = THREE.RepeatWrapping;\n            textures.silver.wrapT = THREE.RepeatWrapping;\n            // textures.silver.repeat.set(1, 1);\n            //\n            textures.weathered = service.getTexture('brushed-dark.jpg');\n            textures.weathered.anisotropy = ANISOTROPY;\n            // textures.weathered.wrapS = THREE.RepeatWrapping;\n            textures.weathered.wrapT = THREE.RepeatWrapping;\n            // textures.weathered.repeat.set(1, 1);\n            // \n            textures.bump = service.getTexture('brushed-dark.jpg');\n            textures.bump.anisotropy = ANISOTROPY;\n            textures.bump.wrapS = THREE.RepeatWrapping;\n            textures.bump.wrapT = THREE.RepeatWrapping;\n            textures.bump.repeat.set(5, 5);\n            //\n            textures.glare = service.getTexture('glare.jpg');\n            textures.glare.anisotropy = ANISOTROPY;\n            //\n            textures.emitterGlare = service.getTexture('emitter-glare.jpg');\n            textures.emitterGlare.anisotropy = ANISOTROPY;\n            //\n            textures.leatherBump = service.getTexture('leather-bump.jpg');\n            textures.leatherBump.anisotropy = ANISOTROPY;\n            textures.leatherBump.wrapS = THREE.RepeatWrapping;\n            textures.leatherBump.wrapT = THREE.RepeatWrapping;\n            // textures.leatherBump.repeat.set(1, 1);\n            //\n            textures.leatherLight = service.getTexture('leather-light.jpg');\n            textures.leatherLight.anisotropy = ANISOTROPY;\n            textures.leatherLight.wrapS = THREE.RepeatWrapping;\n            textures.leatherLight.wrapT = THREE.RepeatWrapping;\n            // textures.leatherLight.repeat.set(1, 1);\n            //\n            textures.reptileBump = service.getTexture('reptile-bump.jpg');\n            textures.reptileBump.anisotropy = ANISOTROPY;\n            textures.reptileBump.wrapS = THREE.RepeatWrapping;\n            textures.reptileBump.wrapT = THREE.RepeatWrapping;\n            // textures.reptileBump.repeat.set(1, 1);\n            //\n            textures.reptileLight = service.getTexture('reptile-light.jpg');\n            textures.reptileLight.anisotropy = ANISOTROPY;\n            textures.reptileLight.wrapS = THREE.RepeatWrapping;\n            textures.reptileLight.wrapT = THREE.RepeatWrapping;\n            // textures.reptileLight.repeat.set(1, 1);\n            //\n            textures.stingrayBump = service.getTexture('stingray-bump.jpg');\n            textures.stingrayBump.anisotropy = ANISOTROPY;\n            textures.stingrayBump.wrapS = THREE.RepeatWrapping;\n            textures.stingrayBump.wrapT = THREE.RepeatWrapping;\n            // textures.stingrayBump.repeat.set(1, 1);\n            //\n            textures.stingrayLight = service.getTexture('stingray-light.jpg');\n            textures.stingrayLight.anisotropy = ANISOTROPY;\n            textures.stingrayLight.wrapS = THREE.RepeatWrapping;\n            textures.stingrayLight.wrapT = THREE.RepeatWrapping;\n            // textures.stingrayLight.repeat.set(1, 1);\n            return textures;\n        }\n\n        function replaceShader() {\n            var fragment = THREE.ShaderChunk.meshphong_frag;\n            // console.log('Library.replaceShader THREE.ShaderChunk.meshphong_frag', fragment);\n            var outgoingLightA = \"vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\";\n            var outgoingLightB = \"vec3 outgoingLight = (reflectedLight.directDiffuse + reflectedLight.indirectDiffuse) * specular + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveLight;\";\n            // console.log('MAterials.replacing meshphong_frag', fragment.indexOf(outgoingLightA));\n            THREE.ShaderChunk.meshphong_frag = fragment.replace(outgoingLightA, outgoingLightB);\n        }\n\n        return Library;\n\n    }();\n\n    window.Library = Library;\n\n}());\n/* global window, document, console, TweenLite */\n\n(function () {\n    'use strict';\n\n    var DEBUG = false;\n    var RAD = Math.PI / 180;\n    var I = 0;\n    var MIN = 11;\n\n    function rad(degree) {\n        return degree * RAD;\n    }\n\n    var Orbiter = function () {\n\n        function Orbiter(scene, camera, controls) {\n            var orbiter = this;\n            orbiter.scene = scene;\n            orbiter.camera = camera;\n            orbiter.dummy = camera.clone();\n            orbiter.controls = controls;\n            orbiter.projector = new THREE.Projector();\n            orbiter.center = new THREE.Vector3();\n            orbiter.size = new THREE.Vector3();\n            orbiter.box = new THREE.Box3();\n            orbiter.boxhelper = new THREE.Box3Helper(orbiter.box, 0xff0000);\n\n            orbiter.rotate = true;\n\n            orbiter.target = new THREE.Vector3(0, 0, 0);\n            orbiter.distance = MIN * 2;\n            orbiter.rotationAngle = 1;\n            orbiter.dragAngle = 0;\n            orbiter.zoom = 1; // eliminabili ??\n            orbiter.pow = 0; // eliminabili ??\n\n            orbiter.values = {\n                target: new THREE.Vector3(0, 0, 0),\n                distance: MIN * 2,\n                rotationAngle: 0,\n                dragAngle: 0,\n                zoom: 0,\n                pow: 0,\n            };\n\n            orbiter.distanceMin = MIN;\n            orbiter.distanceMax = MIN * 3;\n            /*\n            if (combiner.selected.item.type === APP.Parts.typeEnum.BladePlug) {\n                orbiter.pow = 1;\n            } else {\n                orbiter.pow = 0;\n            }\n            */\n            orbiter.set(orbiter.camera, orbiter.target);\n            //\n            if (DEBUG) {\n                orbiter.scene.add(orbiter.boxhelper);\n            }\n        }\n\n        Orbiter.prototype = {\n            fit: fit,\n            set: set,\n            toScreen: toScreen,\n            toWorld: toWorld,\n            tween: tween,\n            update: update,\n        };\n\n        function set(camera, target) {\n            var orbiter = this,\n                values = orbiter.values;\n\n            camera.position.x = target.x + values.distance * values.zoom * Math.cos(values.dragAngle + values.rotationAngle);\n            camera.position.y = target.y + values.distance * values.zoom; // * (0.5 + 1.5 * (1 - values.pow));\n            camera.position.z = target.z + values.distance * values.zoom * Math.sin(values.dragAngle + values.rotationAngle);\n            // camera.up = new THREE.Vector3(0, 0, -1);\n            camera.lookAt(target);\n        }\n\n        function fit(combiner, offset, up) {\n            if (!offset) {\n                offset = 1.3;\n            }\n            if (!up) {\n                up = new THREE.Vector3(0, 1, 0);\n            }\n            var orbiter = this,\n                projector = orbiter.projector,\n                box = orbiter.box,\n                size = orbiter.size,\n                center = orbiter.center,\n                camera = orbiter.camera,\n                controls = orbiter.controls,\n                dummy = orbiter.dummy;\n\n            var object = combiner.selection ? combiner.selection.item.group : combiner.group;\n            box.setFromObject(object);\n            box.getCenter(center);\n            box.getSize(size);\n            if (combiner.items.length > 0) {\n                orbiter.set(dummy, center);\n                /*\n                dummy.position.copy(camera.position);\n                dummy.quaternion.copy(camera.quaternion);\n                dummy.up = up;\n                dummy.lookAt(center);\n                */\n                dummy.fov = camera.fov;\n                dummy.aspect = camera.aspect;\n                /*\n                dummy.updateProjectionMatrix();\n                var min = orbiter.toScreen(box.min);\n                var max = orbiter.toScreen(box.max);\n                var sc = orbiter.toScreen(center);\n                */\n                // dummy.matrixWorldNeedsUpdate = true;\n                // dummy.matrixWorldInverse.getInverse(dummy.matrixWorld);\n                size.applyMatrix4(dummy.matrixWorldInverse);\n                var aspect = size.x / size.y;\n                var dim = (camera.aspect > aspect) ? size.y : size.x;\n                if (camera.aspect < aspect) {\n                    dim /= camera.aspect;\n                }\n                dim *= offset;\n                var z = dim / 2 / Math.sin(camera.fov / 2 * RAD);\n                orbiter.distance = z;\n            } else {\n                orbiter.distance = MIN;\n            }\n            orbiter.distanceMin = orbiter.distance * 0.5;\n            orbiter.distanceMax = orbiter.distance * 1.5;\n            //\n            orbiter.target.copy(center);\n        }\n\n        function tween() {\n            var orbiter = this,\n                target = orbiter.target,\n                values = orbiter.values;\n\n            if (orbiter.rotate) {\n                orbiter.rotationAngle += 0.0002;\n            }\n            var friction = 1 / 15;\n            values.target.x += (target.x - values.target.x) * friction;\n            values.target.y += (target.y - values.target.y) * friction;\n            values.target.z += (target.z - values.target.z) * friction;\n            values.distance += (orbiter.distance - values.distance) * friction;\n            values.rotationAngle += (orbiter.rotationAngle - values.rotationAngle) * friction;\n            values.dragAngle += (orbiter.dragAngle - values.dragAngle) * friction;\n            values.zoom += (orbiter.zoom - values.zoom) * friction;\n            values.pow += (orbiter.pow - values.pow) * friction;\n        }\n\n        function update() {\n            var orbiter = this;\n            orbiter.tween();\n            orbiter.set(orbiter.camera, orbiter.values.target);\n        }\n\n        function toWorld(v) {\n            var orbiter = this,\n                projector = orbiter.projector,\n                camera = orbiter.camera,\n                w = window.innerWidth / 2,\n                h = window.innerHeight / 2;\n            var world = v.clone();\n            world.x = world.x / w - 1;\n            world.y = -world.y / h + 1;\n            projector.unprojectVector(world, camera);\n            return world;\n        }\n\n        function toScreen(v) {\n            var orbiter = this,\n                camera = orbiter.camera,\n                w = window.innerWidth / 2,\n                h = window.innerHeight / 2;\n            var screen = v.clone();\n            screen.project(camera);\n            screen.x = (screen.x + 1) * w;\n            screen.y = (-screen.y + 1) * h;\n            return screen;\n        }\n\n        return Orbiter;\n\n    }();\n\n    window.Orbiter = Orbiter;\n\n}());\n/* global window, document, console, TweenLite, Forge, Combiner, Orbiter, Library */\n\n(function () {\n    'use strict';\n\n    if (!Detector.webgl) {\n        Detector.addGetWebGLMessage();\n        return;\n    }\n\n    var forge = new Forge();\n\n    var btnAdd = document.querySelector('.btn-add');\n    var btnRemove = document.querySelector('.btn-remove');\n    var btnFlip = document.querySelector('.btn-flip');\n    var container = document.querySelector('.editor');\n    var w = container.offsetWidth,\n        h = container.offsetHeight;\n\n    var renderer = new THREE.WebGLRenderer({\n        alpha: true,\n        antialias: true,\n    });\n    renderer.setSize(w, h);\n    container.appendChild(renderer.domElement);\n\n    var camera = new THREE.PerspectiveCamera(45, w / h, 1, 50000);\n    // camera.position.set(0, 20, 40);\n    // camera.lookAt(0, 0, 0);\n    // controls.update() must be called after any manual changes to the camera's transform\n    var controls;\n    // var controls = new THREE.OrbitControls(camera);\n    // controls.update();\n\n    var scene = new THREE.Scene();\n\n    var library = new Library(renderer);\n\n    var lights = addLights(scene);\n\n    /*\n    var light = new THREE.PointLight(0xddddee, 1, 2000);\n    light.position.set(0, 200, 0);\n    scene.add(light);\n    */\n\n    var floor = addFloor(scene);\n\n    var combiner = new Combiner(scene, library);\n    scene.add(combiner.group);\n\n    var orbiter = new Orbiter(scene, camera, controls);\n\n    var effects = new Effects(scene, camera, renderer, w, h);\n\n    var raycaster = new THREE.Raycaster();\n    var down;\n\n    function animate() {\n        requestAnimationFrame(animate);\n        // required if controls.enableDamping or controls.autoRotate are set to true\n        // controls.update();\n        combiner.update();\n        //\n        var y = combiner.center.y - combiner.size.y / 2 - 3;\n        floor.position.y += (y - floor.position.y) / 8;\n        lights.position.x += (combiner.center.x - lights.position.x) / 8;\n        lights.position.y += (combiner.center.y - lights.position.y) / 8;\n        lights.position.z += (combiner.center.z - lights.position.z) / 8;\n        // floor.position.x = combiner.center.x;\n        // floor.position.z = combiner.center.z;\n        //\n        orbiter.update();\n        effects.update();\n        // renderer.render(scene, camera);\n    }\n\n    function addLights(scene) {\n        var lights = new THREE.Group();\n        lights.name = 'pivot';\n        lights.rotation.y = Math.PI / 180 * 90;\n        //\n        var light = new THREE.AmbientLight(0x444444);\n        scene.add(light);\n        // \n        var light1 = new THREE.DirectionalLight(0xeedddd, 1.0, 2000);\n        light1.name = 'light1';\n        light1.position.set(-30, 20, 10);\n        lights.add(light1);\n        //\n        var light2 = new THREE.DirectionalLight(0xddddee, 1.0, 2000);\n        light2.name = 'light2';\n        light2.position.set(30, 20, -10);\n        lights.add(light2);\n        //\n        scene.add(lights);\n        return lights;\n    }\n\n    function addFloor(scene) {\n        /*\n        var radius = 200;\n        var radials = 16;\n        var circles = 8;\n        var divisions = 64;\n        var floor = new THREE.PolarGridHelper(radius, radials, circles, divisions);\n        */\n        // var floor = new THREE.GridHelper(500, 500, 0x888888, 0xAAAAAA);\n        // floor.rotateOnAxis( new THREE.Vector3( 1, 0, 0 ), 90 * ( Math.PI/180 ));\t\n        var floor = new THREE.Mesh(new THREE.PlaneBufferGeometry(500, 500), library.materials.floor);\n        floor.name = 'floor';\n        floor.rotation.x = -Math.PI / 2;\n        floor.position.y = -3.5;\n        floor.visible = true;\n        scene.add(floor);\n        return floor;\n    }\n\n    function onAdd() {\n        if (!combiner.busy()) {\n            forge.load(function (geometry, materials) {\n                if (effects) effects.unselect();\n                var item = combiner.add(geometry, materials);\n                orbiter.fit(combiner);\n                combiner.entering++;\n                item.enter(function () {\n                    combiner.entering--;\n                });\n            });\n        }\n    }\n\n    function onRemove() {\n        if (!combiner.busy()) {\n            combiner.remove();\n            orbiter.fit(combiner);\n        }\n    }\n\n    function onFlip() {\n        combiner.flip(function () {\n            orbiter.fit(combiner);\n        });\n    }\n\n    function onResize() {\n        w = container.offsetWidth;\n        h = container.offsetHeight;\n        camera.aspect = w / h;\n        camera.updateProjectionMatrix();\n        orbiter.fit(combiner);\n        renderer.setSize(w, h);\n        if (effects) effects.resize(w, h);\n    }\n\n    var moved = 0;\n\n    function onDown(e) {\n        down = getTouch(e);\n        down.relativeTo(container);\n        down.mx = down.x;\n        down.startDragAngle = orbiter.dragAngle;\n        down.startDistance = orbiter.distance;\n        // console.log('down', down);\n        raycaster.setFromCamera(down, camera);\n        var selection = combiner.select(raycaster);\n        // console.log('selection', selection);\n        if (selection) {\n            if (controls) {\n                controls.enabled = false;\n            }\n            down.index = selection.index;\n            down.item = selection.item;\n            down.rotation = selection.rotation;\n            if (effects) effects.select(down.item.model);\n        } else {\n            if (effects) effects.unselect();\n        }\n        orbiter.fit(combiner);\n        /*\n        down.index = i;\n        down.item = value;\n        down.angle = value.coords.angle;\n        */\n    }\n\n    function onMove(e) {\n        moved++;\n        var pow = 1; // 0.001;\n        if (e.type === 'touchmove') {\n            e.stopPropagation();\n            e.preventDefault();\n            pow *= 4;\n        }\n        if (down) {\n            var move = getTouch(e);\n            move.relativeTo(container);\n            var diff = move.sub(down);\n            // console.log(diff.x, diff.y);\n            if (move.count == 2 && down.count == 2) {\n                // PINCH                   \n                orbiter.distance = down.startDistance + (down.pinchSize() - move.pinchSize()) * pow * 10;\n            } else {\n                if (combiner.selection && combiner.selection.item === down.item) {\n                    // ROTATE ITEM\n                    // down.item.rotation = down.rotation + (move.y - down.y) * pow * 10;\n                    // var index = down.index;\n                    // down.item.outer.rotation.x = down.rotation.x + diff.y * Math.PI;\n                    combiner.rotate(diff.y * pow * 10);\n                } else {\n                    // DRAG CAMERA\n                    orbiter.dragAngle = down.startDragAngle + diff.x * pow * 10;\n                    orbiter.distance = down.startDistance + diff.y * pow * -10;\n                    /*\n                    // SOUND\n                    if (combiner.selectedItem && combiner.selectedItem.type == APP.Parts.typeEnum.Sound) {\n                        if (Math.abs(move.x - down.mx) > w / 3) {\n                            down.mx = move.x;\n                            scope.$root.$broadcast('onSoundSwing', scope.saber.sound, Math.abs(move.x - down.mx) / 100);\n                        }\n                    }\n                    */\n                }\n            }\n            // orbiter.update();\n            orbiter.distance = Math.min(orbiter.distanceMax, Math.max(orbiter.distanceMin, orbiter.distance));\n            // scope.$root.$broadcast('onControls');\n        }\n    }\n\n    function onUp(e) {\n        if (down && moved < 5) {\n            if (down.item) {\n                /*\n                scope.$apply(function () {\n                    selectedIndex = down.index;\n                    onFocus(down.item);\n                });\n                */\n            } else if (combiner.selectedItem) {\n                /*\n                scope.$apply(function () {\n                    onBlur();\n                });\n                */\n            }\n        }\n        down = null;\n        moved = 0;\n        if (controls) {\n            controls.enabled = true;\n        }\n        removeListeners();\n    }\n\n    function onWheel(e) {\n        e = window.event || e; // old IE support\n        var bounds = container.getBounds();\n        if (Math.abs(e.pageX - bounds.center.x) < bounds.width / 3) {\n            var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));\n            orbiter.distance += delta;\n            orbiter.distance = Math.min(orbiter.distanceMax, Math.max(orbiter.distanceMin, orbiter.distance));\n            orbiter.update();\n            e.preventDefault();\n            // scope.$root.$broadcast('onControls');\n        }\n    }\n\n    function onDoubleClick(e) {\n        console.log('onDoubleClick');\n        var touch = getTouch(e);\n        raycaster.setFromCamera(touch, camera);\n        combiner.hitAndFlip(raycaster, function () {\n            orbiter.fit(combiner);\n        });\n    }\n\n    function onMouseDown(e) {\n        onDown(e);\n        addMouseListeners();\n    }\n\n    function onTouchDown(e) {\n        onDown(e);\n        addTouchListeners();\n        e.stopPropagation();\n        e.preventDefault();\n    }\n\n    function addMouseListeners() {\n        window.addEventListener('mousemove', onMove);\n        window.addEventListener('mouseup', onUp);\n    }\n\n    function addTouchListeners() {\n        window.addEventListener('touchmove', onMove);\n        window.addEventListener('touchend', onUp);\n    }\n\n    function removeListeners() {\n        window.removeEventListener('touchmove mousemove', onMove);\n        window.removeEventListener('touchend mouseup', onUp);\n    }\n\n    // container.addEventListener('dblclick', onDoubleClick);\n    container.addEventListener('mousedown', onMouseDown);\n    container.addEventListener('touchstart', onTouchDown);\n    container.addEventListener('mousewheel', onWheel);\n\n    window.addEventListener('resize', onResize, false);\n    btnAdd.addEventListener('click', onAdd);\n    btnRemove.addEventListener('click', onRemove);\n    btnFlip.addEventListener('click', onFlip);\n\n    animate();\n\n    setTimeout(onAdd, 1000);\n\n}());"]}